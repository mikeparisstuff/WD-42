<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <title>mod.rs.html -- source</title>

    <link href='http://fonts.googleapis.com/css?family=Oswald:700|Inconsolata:400,700'
          rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="../../../../../../main.css">

    
</head>
<body>
    <!--[if lte IE 8]>
    <div class="warning">
        This old browser is unsupported and will most likely display funky
        things.
    </div>
    <![endif]-->

    <section class="sidebar">
        

        
    </section>

    <nav class="sub">
        <form class="search-form js-only">
            <button class="do-search">Search</button>
            <div class="search-container">
                <input class="search-input" name="search"
                       autocomplete="off"
                       placeholder="Search documentation..."
                       type="search" />
            </div>
        </form>
    </nav>

    <section id='main' class="content source"><pre class='line-numbers'><span id='1'>   1</span>
<span id='2'>   2</span>
<span id='3'>   3</span>
<span id='4'>   4</span>
<span id='5'>   5</span>
<span id='6'>   6</span>
<span id='7'>   7</span>
<span id='8'>   8</span>
<span id='9'>   9</span>
<span id='10'>  10</span>
<span id='11'>  11</span>
<span id='12'>  12</span>
<span id='13'>  13</span>
<span id='14'>  14</span>
<span id='15'>  15</span>
<span id='16'>  16</span>
<span id='17'>  17</span>
<span id='18'>  18</span>
<span id='19'>  19</span>
<span id='20'>  20</span>
<span id='21'>  21</span>
<span id='22'>  22</span>
<span id='23'>  23</span>
<span id='24'>  24</span>
<span id='25'>  25</span>
<span id='26'>  26</span>
<span id='27'>  27</span>
<span id='28'>  28</span>
<span id='29'>  29</span>
<span id='30'>  30</span>
<span id='31'>  31</span>
<span id='32'>  32</span>
<span id='33'>  33</span>
<span id='34'>  34</span>
<span id='35'>  35</span>
<span id='36'>  36</span>
<span id='37'>  37</span>
<span id='38'>  38</span>
<span id='39'>  39</span>
<span id='40'>  40</span>
<span id='41'>  41</span>
<span id='42'>  42</span>
<span id='43'>  43</span>
<span id='44'>  44</span>
<span id='45'>  45</span>
<span id='46'>  46</span>
<span id='47'>  47</span>
<span id='48'>  48</span>
<span id='49'>  49</span>
<span id='50'>  50</span>
<span id='51'>  51</span>
<span id='52'>  52</span>
<span id='53'>  53</span>
<span id='54'>  54</span>
<span id='55'>  55</span>
<span id='56'>  56</span>
<span id='57'>  57</span>
<span id='58'>  58</span>
<span id='59'>  59</span>
<span id='60'>  60</span>
<span id='61'>  61</span>
<span id='62'>  62</span>
<span id='63'>  63</span>
<span id='64'>  64</span>
<span id='65'>  65</span>
<span id='66'>  66</span>
<span id='67'>  67</span>
<span id='68'>  68</span>
<span id='69'>  69</span>
<span id='70'>  70</span>
<span id='71'>  71</span>
<span id='72'>  72</span>
<span id='73'>  73</span>
<span id='74'>  74</span>
<span id='75'>  75</span>
<span id='76'>  76</span>
<span id='77'>  77</span>
<span id='78'>  78</span>
<span id='79'>  79</span>
<span id='80'>  80</span>
<span id='81'>  81</span>
<span id='82'>  82</span>
<span id='83'>  83</span>
<span id='84'>  84</span>
<span id='85'>  85</span>
<span id='86'>  86</span>
<span id='87'>  87</span>
<span id='88'>  88</span>
<span id='89'>  89</span>
<span id='90'>  90</span>
<span id='91'>  91</span>
<span id='92'>  92</span>
<span id='93'>  93</span>
<span id='94'>  94</span>
<span id='95'>  95</span>
<span id='96'>  96</span>
<span id='97'>  97</span>
<span id='98'>  98</span>
<span id='99'>  99</span>
<span id='100'> 100</span>
<span id='101'> 101</span>
<span id='102'> 102</span>
<span id='103'> 103</span>
<span id='104'> 104</span>
<span id='105'> 105</span>
<span id='106'> 106</span>
<span id='107'> 107</span>
<span id='108'> 108</span>
<span id='109'> 109</span>
<span id='110'> 110</span>
<span id='111'> 111</span>
<span id='112'> 112</span>
<span id='113'> 113</span>
<span id='114'> 114</span>
<span id='115'> 115</span>
<span id='116'> 116</span>
<span id='117'> 117</span>
<span id='118'> 118</span>
<span id='119'> 119</span>
<span id='120'> 120</span>
<span id='121'> 121</span>
<span id='122'> 122</span>
<span id='123'> 123</span>
<span id='124'> 124</span>
<span id='125'> 125</span>
<span id='126'> 126</span>
<span id='127'> 127</span>
<span id='128'> 128</span>
<span id='129'> 129</span>
<span id='130'> 130</span>
<span id='131'> 131</span>
<span id='132'> 132</span>
<span id='133'> 133</span>
<span id='134'> 134</span>
<span id='135'> 135</span>
<span id='136'> 136</span>
<span id='137'> 137</span>
<span id='138'> 138</span>
<span id='139'> 139</span>
<span id='140'> 140</span>
<span id='141'> 141</span>
<span id='142'> 142</span>
<span id='143'> 143</span>
<span id='144'> 144</span>
<span id='145'> 145</span>
<span id='146'> 146</span>
<span id='147'> 147</span>
<span id='148'> 148</span>
<span id='149'> 149</span>
<span id='150'> 150</span>
<span id='151'> 151</span>
<span id='152'> 152</span>
<span id='153'> 153</span>
<span id='154'> 154</span>
<span id='155'> 155</span>
<span id='156'> 156</span>
<span id='157'> 157</span>
<span id='158'> 158</span>
<span id='159'> 159</span>
<span id='160'> 160</span>
<span id='161'> 161</span>
<span id='162'> 162</span>
<span id='163'> 163</span>
<span id='164'> 164</span>
<span id='165'> 165</span>
<span id='166'> 166</span>
<span id='167'> 167</span>
<span id='168'> 168</span>
<span id='169'> 169</span>
<span id='170'> 170</span>
<span id='171'> 171</span>
<span id='172'> 172</span>
<span id='173'> 173</span>
<span id='174'> 174</span>
<span id='175'> 175</span>
<span id='176'> 176</span>
<span id='177'> 177</span>
<span id='178'> 178</span>
<span id='179'> 179</span>
<span id='180'> 180</span>
<span id='181'> 181</span>
<span id='182'> 182</span>
<span id='183'> 183</span>
<span id='184'> 184</span>
<span id='185'> 185</span>
<span id='186'> 186</span>
<span id='187'> 187</span>
<span id='188'> 188</span>
<span id='189'> 189</span>
<span id='190'> 190</span>
<span id='191'> 191</span>
<span id='192'> 192</span>
<span id='193'> 193</span>
<span id='194'> 194</span>
<span id='195'> 195</span>
<span id='196'> 196</span>
<span id='197'> 197</span>
<span id='198'> 198</span>
<span id='199'> 199</span>
<span id='200'> 200</span>
<span id='201'> 201</span>
<span id='202'> 202</span>
<span id='203'> 203</span>
<span id='204'> 204</span>
<span id='205'> 205</span>
<span id='206'> 206</span>
<span id='207'> 207</span>
<span id='208'> 208</span>
<span id='209'> 209</span>
<span id='210'> 210</span>
<span id='211'> 211</span>
<span id='212'> 212</span>
<span id='213'> 213</span>
<span id='214'> 214</span>
<span id='215'> 215</span>
<span id='216'> 216</span>
<span id='217'> 217</span>
<span id='218'> 218</span>
<span id='219'> 219</span>
<span id='220'> 220</span>
<span id='221'> 221</span>
<span id='222'> 222</span>
<span id='223'> 223</span>
<span id='224'> 224</span>
<span id='225'> 225</span>
<span id='226'> 226</span>
<span id='227'> 227</span>
<span id='228'> 228</span>
<span id='229'> 229</span>
<span id='230'> 230</span>
<span id='231'> 231</span>
<span id='232'> 232</span>
<span id='233'> 233</span>
<span id='234'> 234</span>
<span id='235'> 235</span>
<span id='236'> 236</span>
<span id='237'> 237</span>
<span id='238'> 238</span>
<span id='239'> 239</span>
<span id='240'> 240</span>
<span id='241'> 241</span>
<span id='242'> 242</span>
<span id='243'> 243</span>
<span id='244'> 244</span>
<span id='245'> 245</span>
<span id='246'> 246</span>
<span id='247'> 247</span>
<span id='248'> 248</span>
<span id='249'> 249</span>
<span id='250'> 250</span>
<span id='251'> 251</span>
<span id='252'> 252</span>
<span id='253'> 253</span>
<span id='254'> 254</span>
<span id='255'> 255</span>
<span id='256'> 256</span>
<span id='257'> 257</span>
<span id='258'> 258</span>
<span id='259'> 259</span>
<span id='260'> 260</span>
<span id='261'> 261</span>
<span id='262'> 262</span>
<span id='263'> 263</span>
<span id='264'> 264</span>
<span id='265'> 265</span>
<span id='266'> 266</span>
<span id='267'> 267</span>
<span id='268'> 268</span>
<span id='269'> 269</span>
<span id='270'> 270</span>
<span id='271'> 271</span>
<span id='272'> 272</span>
<span id='273'> 273</span>
<span id='274'> 274</span>
<span id='275'> 275</span>
<span id='276'> 276</span>
<span id='277'> 277</span>
<span id='278'> 278</span>
<span id='279'> 279</span>
<span id='280'> 280</span>
<span id='281'> 281</span>
<span id='282'> 282</span>
<span id='283'> 283</span>
<span id='284'> 284</span>
<span id='285'> 285</span>
<span id='286'> 286</span>
<span id='287'> 287</span>
<span id='288'> 288</span>
<span id='289'> 289</span>
<span id='290'> 290</span>
<span id='291'> 291</span>
<span id='292'> 292</span>
<span id='293'> 293</span>
<span id='294'> 294</span>
<span id='295'> 295</span>
<span id='296'> 296</span>
<span id='297'> 297</span>
<span id='298'> 298</span>
<span id='299'> 299</span>
<span id='300'> 300</span>
<span id='301'> 301</span>
<span id='302'> 302</span>
<span id='303'> 303</span>
<span id='304'> 304</span>
<span id='305'> 305</span>
<span id='306'> 306</span>
<span id='307'> 307</span>
<span id='308'> 308</span>
<span id='309'> 309</span>
<span id='310'> 310</span>
<span id='311'> 311</span>
<span id='312'> 312</span>
<span id='313'> 313</span>
<span id='314'> 314</span>
<span id='315'> 315</span>
<span id='316'> 316</span>
<span id='317'> 317</span>
<span id='318'> 318</span>
<span id='319'> 319</span>
<span id='320'> 320</span>
<span id='321'> 321</span>
<span id='322'> 322</span>
<span id='323'> 323</span>
<span id='324'> 324</span>
<span id='325'> 325</span>
<span id='326'> 326</span>
<span id='327'> 327</span>
<span id='328'> 328</span>
<span id='329'> 329</span>
<span id='330'> 330</span>
<span id='331'> 331</span>
<span id='332'> 332</span>
<span id='333'> 333</span>
<span id='334'> 334</span>
<span id='335'> 335</span>
<span id='336'> 336</span>
<span id='337'> 337</span>
<span id='338'> 338</span>
<span id='339'> 339</span>
<span id='340'> 340</span>
<span id='341'> 341</span>
<span id='342'> 342</span>
<span id='343'> 343</span>
<span id='344'> 344</span>
<span id='345'> 345</span>
<span id='346'> 346</span>
<span id='347'> 347</span>
<span id='348'> 348</span>
<span id='349'> 349</span>
<span id='350'> 350</span>
<span id='351'> 351</span>
<span id='352'> 352</span>
<span id='353'> 353</span>
<span id='354'> 354</span>
<span id='355'> 355</span>
<span id='356'> 356</span>
<span id='357'> 357</span>
<span id='358'> 358</span>
<span id='359'> 359</span>
<span id='360'> 360</span>
<span id='361'> 361</span>
<span id='362'> 362</span>
<span id='363'> 363</span>
<span id='364'> 364</span>
<span id='365'> 365</span>
<span id='366'> 366</span>
<span id='367'> 367</span>
<span id='368'> 368</span>
<span id='369'> 369</span>
<span id='370'> 370</span>
<span id='371'> 371</span>
<span id='372'> 372</span>
<span id='373'> 373</span>
<span id='374'> 374</span>
<span id='375'> 375</span>
<span id='376'> 376</span>
<span id='377'> 377</span>
<span id='378'> 378</span>
<span id='379'> 379</span>
<span id='380'> 380</span>
<span id='381'> 381</span>
<span id='382'> 382</span>
<span id='383'> 383</span>
<span id='384'> 384</span>
<span id='385'> 385</span>
<span id='386'> 386</span>
<span id='387'> 387</span>
<span id='388'> 388</span>
<span id='389'> 389</span>
<span id='390'> 390</span>
<span id='391'> 391</span>
<span id='392'> 392</span>
<span id='393'> 393</span>
<span id='394'> 394</span>
<span id='395'> 395</span>
<span id='396'> 396</span>
<span id='397'> 397</span>
<span id='398'> 398</span>
<span id='399'> 399</span>
<span id='400'> 400</span>
<span id='401'> 401</span>
<span id='402'> 402</span>
<span id='403'> 403</span>
<span id='404'> 404</span>
<span id='405'> 405</span>
<span id='406'> 406</span>
<span id='407'> 407</span>
<span id='408'> 408</span>
<span id='409'> 409</span>
<span id='410'> 410</span>
<span id='411'> 411</span>
<span id='412'> 412</span>
<span id='413'> 413</span>
<span id='414'> 414</span>
<span id='415'> 415</span>
<span id='416'> 416</span>
<span id='417'> 417</span>
<span id='418'> 418</span>
<span id='419'> 419</span>
<span id='420'> 420</span>
<span id='421'> 421</span>
<span id='422'> 422</span>
<span id='423'> 423</span>
<span id='424'> 424</span>
<span id='425'> 425</span>
<span id='426'> 426</span>
<span id='427'> 427</span>
<span id='428'> 428</span>
<span id='429'> 429</span>
<span id='430'> 430</span>
<span id='431'> 431</span>
<span id='432'> 432</span>
<span id='433'> 433</span>
<span id='434'> 434</span>
<span id='435'> 435</span>
<span id='436'> 436</span>
<span id='437'> 437</span>
<span id='438'> 438</span>
<span id='439'> 439</span>
<span id='440'> 440</span>
<span id='441'> 441</span>
<span id='442'> 442</span>
<span id='443'> 443</span>
<span id='444'> 444</span>
<span id='445'> 445</span>
<span id='446'> 446</span>
<span id='447'> 447</span>
<span id='448'> 448</span>
<span id='449'> 449</span>
<span id='450'> 450</span>
<span id='451'> 451</span>
<span id='452'> 452</span>
<span id='453'> 453</span>
<span id='454'> 454</span>
<span id='455'> 455</span>
<span id='456'> 456</span>
<span id='457'> 457</span>
<span id='458'> 458</span>
<span id='459'> 459</span>
<span id='460'> 460</span>
<span id='461'> 461</span>
<span id='462'> 462</span>
<span id='463'> 463</span>
<span id='464'> 464</span>
<span id='465'> 465</span>
<span id='466'> 466</span>
<span id='467'> 467</span>
<span id='468'> 468</span>
<span id='469'> 469</span>
<span id='470'> 470</span>
<span id='471'> 471</span>
<span id='472'> 472</span>
<span id='473'> 473</span>
<span id='474'> 474</span>
<span id='475'> 475</span>
<span id='476'> 476</span>
<span id='477'> 477</span>
<span id='478'> 478</span>
<span id='479'> 479</span>
<span id='480'> 480</span>
<span id='481'> 481</span>
<span id='482'> 482</span>
<span id='483'> 483</span>
<span id='484'> 484</span>
<span id='485'> 485</span>
<span id='486'> 486</span>
<span id='487'> 487</span>
<span id='488'> 488</span>
<span id='489'> 489</span>
<span id='490'> 490</span>
<span id='491'> 491</span>
<span id='492'> 492</span>
<span id='493'> 493</span>
<span id='494'> 494</span>
<span id='495'> 495</span>
<span id='496'> 496</span>
<span id='497'> 497</span>
<span id='498'> 498</span>
<span id='499'> 499</span>
<span id='500'> 500</span>
<span id='501'> 501</span>
<span id='502'> 502</span>
<span id='503'> 503</span>
<span id='504'> 504</span>
<span id='505'> 505</span>
<span id='506'> 506</span>
<span id='507'> 507</span>
<span id='508'> 508</span>
<span id='509'> 509</span>
<span id='510'> 510</span>
<span id='511'> 511</span>
<span id='512'> 512</span>
<span id='513'> 513</span>
<span id='514'> 514</span>
<span id='515'> 515</span>
<span id='516'> 516</span>
<span id='517'> 517</span>
<span id='518'> 518</span>
<span id='519'> 519</span>
<span id='520'> 520</span>
<span id='521'> 521</span>
<span id='522'> 522</span>
<span id='523'> 523</span>
<span id='524'> 524</span>
<span id='525'> 525</span>
<span id='526'> 526</span>
<span id='527'> 527</span>
<span id='528'> 528</span>
<span id='529'> 529</span>
<span id='530'> 530</span>
<span id='531'> 531</span>
<span id='532'> 532</span>
<span id='533'> 533</span>
<span id='534'> 534</span>
<span id='535'> 535</span>
<span id='536'> 536</span>
<span id='537'> 537</span>
<span id='538'> 538</span>
<span id='539'> 539</span>
<span id='540'> 540</span>
<span id='541'> 541</span>
<span id='542'> 542</span>
<span id='543'> 543</span>
<span id='544'> 544</span>
<span id='545'> 545</span>
<span id='546'> 546</span>
<span id='547'> 547</span>
<span id='548'> 548</span>
<span id='549'> 549</span>
<span id='550'> 550</span>
<span id='551'> 551</span>
<span id='552'> 552</span>
<span id='553'> 553</span>
<span id='554'> 554</span>
<span id='555'> 555</span>
<span id='556'> 556</span>
<span id='557'> 557</span>
<span id='558'> 558</span>
<span id='559'> 559</span>
<span id='560'> 560</span>
<span id='561'> 561</span>
<span id='562'> 562</span>
<span id='563'> 563</span>
<span id='564'> 564</span>
<span id='565'> 565</span>
<span id='566'> 566</span>
<span id='567'> 567</span>
<span id='568'> 568</span>
<span id='569'> 569</span>
<span id='570'> 570</span>
<span id='571'> 571</span>
<span id='572'> 572</span>
<span id='573'> 573</span>
<span id='574'> 574</span>
<span id='575'> 575</span>
<span id='576'> 576</span>
<span id='577'> 577</span>
<span id='578'> 578</span>
<span id='579'> 579</span>
<span id='580'> 580</span>
<span id='581'> 581</span>
<span id='582'> 582</span>
<span id='583'> 583</span>
<span id='584'> 584</span>
<span id='585'> 585</span>
<span id='586'> 586</span>
<span id='587'> 587</span>
<span id='588'> 588</span>
<span id='589'> 589</span>
<span id='590'> 590</span>
<span id='591'> 591</span>
<span id='592'> 592</span>
<span id='593'> 593</span>
<span id='594'> 594</span>
<span id='595'> 595</span>
<span id='596'> 596</span>
<span id='597'> 597</span>
<span id='598'> 598</span>
<span id='599'> 599</span>
<span id='600'> 600</span>
<span id='601'> 601</span>
<span id='602'> 602</span>
<span id='603'> 603</span>
<span id='604'> 604</span>
<span id='605'> 605</span>
<span id='606'> 606</span>
<span id='607'> 607</span>
<span id='608'> 608</span>
<span id='609'> 609</span>
<span id='610'> 610</span>
<span id='611'> 611</span>
<span id='612'> 612</span>
<span id='613'> 613</span>
<span id='614'> 614</span>
<span id='615'> 615</span>
<span id='616'> 616</span>
<span id='617'> 617</span>
<span id='618'> 618</span>
<span id='619'> 619</span>
<span id='620'> 620</span>
<span id='621'> 621</span>
<span id='622'> 622</span>
<span id='623'> 623</span>
<span id='624'> 624</span>
<span id='625'> 625</span>
<span id='626'> 626</span>
<span id='627'> 627</span>
<span id='628'> 628</span>
<span id='629'> 629</span>
<span id='630'> 630</span>
<span id='631'> 631</span>
<span id='632'> 632</span>
<span id='633'> 633</span>
<span id='634'> 634</span>
<span id='635'> 635</span>
<span id='636'> 636</span>
<span id='637'> 637</span>
<span id='638'> 638</span>
<span id='639'> 639</span>
<span id='640'> 640</span>
<span id='641'> 641</span>
<span id='642'> 642</span>
<span id='643'> 643</span>
<span id='644'> 644</span>
<span id='645'> 645</span>
<span id='646'> 646</span>
<span id='647'> 647</span>
<span id='648'> 648</span>
<span id='649'> 649</span>
<span id='650'> 650</span>
<span id='651'> 651</span>
<span id='652'> 652</span>
<span id='653'> 653</span>
<span id='654'> 654</span>
<span id='655'> 655</span>
<span id='656'> 656</span>
<span id='657'> 657</span>
<span id='658'> 658</span>
<span id='659'> 659</span>
<span id='660'> 660</span>
<span id='661'> 661</span>
<span id='662'> 662</span>
<span id='663'> 663</span>
<span id='664'> 664</span>
<span id='665'> 665</span>
<span id='666'> 666</span>
<span id='667'> 667</span>
<span id='668'> 668</span>
<span id='669'> 669</span>
<span id='670'> 670</span>
<span id='671'> 671</span>
<span id='672'> 672</span>
<span id='673'> 673</span>
<span id='674'> 674</span>
<span id='675'> 675</span>
<span id='676'> 676</span>
<span id='677'> 677</span>
<span id='678'> 678</span>
<span id='679'> 679</span>
<span id='680'> 680</span>
<span id='681'> 681</span>
<span id='682'> 682</span>
<span id='683'> 683</span>
<span id='684'> 684</span>
<span id='685'> 685</span>
<span id='686'> 686</span>
<span id='687'> 687</span>
<span id='688'> 688</span>
<span id='689'> 689</span>
<span id='690'> 690</span>
<span id='691'> 691</span>
<span id='692'> 692</span>
<span id='693'> 693</span>
<span id='694'> 694</span>
<span id='695'> 695</span>
<span id='696'> 696</span>
<span id='697'> 697</span>
<span id='698'> 698</span>
<span id='699'> 699</span>
<span id='700'> 700</span>
<span id='701'> 701</span>
<span id='702'> 702</span>
<span id='703'> 703</span>
<span id='704'> 704</span>
<span id='705'> 705</span>
<span id='706'> 706</span>
<span id='707'> 707</span>
<span id='708'> 708</span>
<span id='709'> 709</span>
<span id='710'> 710</span>
<span id='711'> 711</span>
<span id='712'> 712</span>
<span id='713'> 713</span>
<span id='714'> 714</span>
<span id='715'> 715</span>
<span id='716'> 716</span>
<span id='717'> 717</span>
<span id='718'> 718</span>
<span id='719'> 719</span>
<span id='720'> 720</span>
<span id='721'> 721</span>
<span id='722'> 722</span>
<span id='723'> 723</span>
<span id='724'> 724</span>
<span id='725'> 725</span>
<span id='726'> 726</span>
<span id='727'> 727</span>
<span id='728'> 728</span>
<span id='729'> 729</span>
<span id='730'> 730</span>
<span id='731'> 731</span>
<span id='732'> 732</span>
<span id='733'> 733</span>
<span id='734'> 734</span>
<span id='735'> 735</span>
<span id='736'> 736</span>
<span id='737'> 737</span>
<span id='738'> 738</span>
<span id='739'> 739</span>
<span id='740'> 740</span>
<span id='741'> 741</span>
<span id='742'> 742</span>
<span id='743'> 743</span>
<span id='744'> 744</span>
<span id='745'> 745</span>
<span id='746'> 746</span>
<span id='747'> 747</span>
<span id='748'> 748</span>
<span id='749'> 749</span>
<span id='750'> 750</span>
<span id='751'> 751</span>
<span id='752'> 752</span>
<span id='753'> 753</span>
<span id='754'> 754</span>
<span id='755'> 755</span>
<span id='756'> 756</span>
<span id='757'> 757</span>
<span id='758'> 758</span>
<span id='759'> 759</span>
<span id='760'> 760</span>
<span id='761'> 761</span>
<span id='762'> 762</span>
<span id='763'> 763</span>
<span id='764'> 764</span>
<span id='765'> 765</span>
<span id='766'> 766</span>
<span id='767'> 767</span>
<span id='768'> 768</span>
<span id='769'> 769</span>
<span id='770'> 770</span>
<span id='771'> 771</span>
<span id='772'> 772</span>
<span id='773'> 773</span>
<span id='774'> 774</span>
<span id='775'> 775</span>
<span id='776'> 776</span>
<span id='777'> 777</span>
<span id='778'> 778</span>
<span id='779'> 779</span>
<span id='780'> 780</span>
<span id='781'> 781</span>
<span id='782'> 782</span>
<span id='783'> 783</span>
<span id='784'> 784</span>
<span id='785'> 785</span>
<span id='786'> 786</span>
<span id='787'> 787</span>
<span id='788'> 788</span>
<span id='789'> 789</span>
<span id='790'> 790</span>
<span id='791'> 791</span>
<span id='792'> 792</span>
<span id='793'> 793</span>
<span id='794'> 794</span>
<span id='795'> 795</span>
<span id='796'> 796</span>
<span id='797'> 797</span>
<span id='798'> 798</span>
<span id='799'> 799</span>
<span id='800'> 800</span>
<span id='801'> 801</span>
<span id='802'> 802</span>
<span id='803'> 803</span>
<span id='804'> 804</span>
<span id='805'> 805</span>
<span id='806'> 806</span>
<span id='807'> 807</span>
<span id='808'> 808</span>
<span id='809'> 809</span>
<span id='810'> 810</span>
<span id='811'> 811</span>
<span id='812'> 812</span>
<span id='813'> 813</span>
<span id='814'> 814</span>
<span id='815'> 815</span>
<span id='816'> 816</span>
<span id='817'> 817</span>
<span id='818'> 818</span>
<span id='819'> 819</span>
<span id='820'> 820</span>
<span id='821'> 821</span>
<span id='822'> 822</span>
<span id='823'> 823</span>
<span id='824'> 824</span>
<span id='825'> 825</span>
<span id='826'> 826</span>
<span id='827'> 827</span>
<span id='828'> 828</span>
<span id='829'> 829</span>
<span id='830'> 830</span>
<span id='831'> 831</span>
<span id='832'> 832</span>
<span id='833'> 833</span>
<span id='834'> 834</span>
<span id='835'> 835</span>
<span id='836'> 836</span>
<span id='837'> 837</span>
<span id='838'> 838</span>
<span id='839'> 839</span>
<span id='840'> 840</span>
<span id='841'> 841</span>
<span id='842'> 842</span>
<span id='843'> 843</span>
<span id='844'> 844</span>
<span id='845'> 845</span>
<span id='846'> 846</span>
<span id='847'> 847</span>
<span id='848'> 848</span>
<span id='849'> 849</span>
<span id='850'> 850</span>
<span id='851'> 851</span>
<span id='852'> 852</span>
<span id='853'> 853</span>
<span id='854'> 854</span>
<span id='855'> 855</span>
<span id='856'> 856</span>
<span id='857'> 857</span>
<span id='858'> 858</span>
<span id='859'> 859</span>
<span id='860'> 860</span>
<span id='861'> 861</span>
<span id='862'> 862</span>
<span id='863'> 863</span>
<span id='864'> 864</span>
<span id='865'> 865</span>
<span id='866'> 866</span>
<span id='867'> 867</span>
<span id='868'> 868</span>
<span id='869'> 869</span>
<span id='870'> 870</span>
<span id='871'> 871</span>
<span id='872'> 872</span>
<span id='873'> 873</span>
<span id='874'> 874</span>
<span id='875'> 875</span>
<span id='876'> 876</span>
<span id='877'> 877</span>
<span id='878'> 878</span>
<span id='879'> 879</span>
<span id='880'> 880</span>
<span id='881'> 881</span>
<span id='882'> 882</span>
<span id='883'> 883</span>
<span id='884'> 884</span>
<span id='885'> 885</span>
<span id='886'> 886</span>
<span id='887'> 887</span>
<span id='888'> 888</span>
<span id='889'> 889</span>
<span id='890'> 890</span>
<span id='891'> 891</span>
<span id='892'> 892</span>
<span id='893'> 893</span>
<span id='894'> 894</span>
<span id='895'> 895</span>
<span id='896'> 896</span>
<span id='897'> 897</span>
<span id='898'> 898</span>
<span id='899'> 899</span>
<span id='900'> 900</span>
<span id='901'> 901</span>
<span id='902'> 902</span>
<span id='903'> 903</span>
<span id='904'> 904</span>
<span id='905'> 905</span>
<span id='906'> 906</span>
<span id='907'> 907</span>
<span id='908'> 908</span>
<span id='909'> 909</span>
<span id='910'> 910</span>
<span id='911'> 911</span>
<span id='912'> 912</span>
<span id='913'> 913</span>
<span id='914'> 914</span>
<span id='915'> 915</span>
<span id='916'> 916</span>
<span id='917'> 917</span>
<span id='918'> 918</span>
<span id='919'> 919</span>
<span id='920'> 920</span>
<span id='921'> 921</span>
<span id='922'> 922</span>
<span id='923'> 923</span>
<span id='924'> 924</span>
<span id='925'> 925</span>
<span id='926'> 926</span>
<span id='927'> 927</span>
<span id='928'> 928</span>
<span id='929'> 929</span>
<span id='930'> 930</span>
<span id='931'> 931</span>
<span id='932'> 932</span>
<span id='933'> 933</span>
<span id='934'> 934</span>
<span id='935'> 935</span>
<span id='936'> 936</span>
<span id='937'> 937</span>
<span id='938'> 938</span>
<span id='939'> 939</span>
<span id='940'> 940</span>
<span id='941'> 941</span>
<span id='942'> 942</span>
<span id='943'> 943</span>
<span id='944'> 944</span>
<span id='945'> 945</span>
<span id='946'> 946</span>
<span id='947'> 947</span>
<span id='948'> 948</span>
<span id='949'> 949</span>
<span id='950'> 950</span>
<span id='951'> 951</span>
<span id='952'> 952</span>
<span id='953'> 953</span>
<span id='954'> 954</span>
<span id='955'> 955</span>
<span id='956'> 956</span>
<span id='957'> 957</span>
<span id='958'> 958</span>
<span id='959'> 959</span>
<span id='960'> 960</span>
<span id='961'> 961</span>
<span id='962'> 962</span>
<span id='963'> 963</span>
<span id='964'> 964</span>
<span id='965'> 965</span>
<span id='966'> 966</span>
<span id='967'> 967</span>
<span id='968'> 968</span>
<span id='969'> 969</span>
<span id='970'> 970</span>
<span id='971'> 971</span>
<span id='972'> 972</span>
<span id='973'> 973</span>
<span id='974'> 974</span>
<span id='975'> 975</span>
<span id='976'> 976</span>
<span id='977'> 977</span>
<span id='978'> 978</span>
<span id='979'> 979</span>
<span id='980'> 980</span>
<span id='981'> 981</span>
<span id='982'> 982</span>
<span id='983'> 983</span>
<span id='984'> 984</span>
<span id='985'> 985</span>
<span id='986'> 986</span>
<span id='987'> 987</span>
<span id='988'> 988</span>
<span id='989'> 989</span>
<span id='990'> 990</span>
<span id='991'> 991</span>
<span id='992'> 992</span>
<span id='993'> 993</span>
<span id='994'> 994</span>
<span id='995'> 995</span>
<span id='996'> 996</span>
<span id='997'> 997</span>
<span id='998'> 998</span>
<span id='999'> 999</span>
<span id='1000'>1000</span>
<span id='1001'>1001</span>
<span id='1002'>1002</span>
<span id='1003'>1003</span>
<span id='1004'>1004</span>
<span id='1005'>1005</span>
<span id='1006'>1006</span>
<span id='1007'>1007</span>
<span id='1008'>1008</span>
<span id='1009'>1009</span>
<span id='1010'>1010</span>
<span id='1011'>1011</span>
<span id='1012'>1012</span>
<span id='1013'>1013</span>
<span id='1014'>1014</span>
<span id='1015'>1015</span>
<span id='1016'>1016</span>
<span id='1017'>1017</span>
<span id='1018'>1018</span>
<span id='1019'>1019</span>
<span id='1020'>1020</span>
<span id='1021'>1021</span>
<span id='1022'>1022</span>
<span id='1023'>1023</span>
<span id='1024'>1024</span>
<span id='1025'>1025</span>
<span id='1026'>1026</span>
<span id='1027'>1027</span>
<span id='1028'>1028</span>
<span id='1029'>1029</span>
<span id='1030'>1030</span>
<span id='1031'>1031</span>
<span id='1032'>1032</span>
<span id='1033'>1033</span>
<span id='1034'>1034</span>
<span id='1035'>1035</span>
<span id='1036'>1036</span>
<span id='1037'>1037</span>
<span id='1038'>1038</span>
<span id='1039'>1039</span>
<span id='1040'>1040</span>
<span id='1041'>1041</span>
<span id='1042'>1042</span>
<span id='1043'>1043</span>
<span id='1044'>1044</span>
<span id='1045'>1045</span>
<span id='1046'>1046</span>
<span id='1047'>1047</span>
<span id='1048'>1048</span>
<span id='1049'>1049</span>
<span id='1050'>1050</span>
<span id='1051'>1051</span>
<span id='1052'>1052</span>
<span id='1053'>1053</span>
<span id='1054'>1054</span>
<span id='1055'>1055</span>
<span id='1056'>1056</span>
<span id='1057'>1057</span>
<span id='1058'>1058</span>
<span id='1059'>1059</span>
<span id='1060'>1060</span>
<span id='1061'>1061</span>
<span id='1062'>1062</span>
<span id='1063'>1063</span>
<span id='1064'>1064</span>
<span id='1065'>1065</span>
<span id='1066'>1066</span>
<span id='1067'>1067</span>
<span id='1068'>1068</span>
<span id='1069'>1069</span>
<span id='1070'>1070</span>
<span id='1071'>1071</span>
<span id='1072'>1072</span>
<span id='1073'>1073</span>
<span id='1074'>1074</span>
<span id='1075'>1075</span>
<span id='1076'>1076</span>
<span id='1077'>1077</span>
<span id='1078'>1078</span>
<span id='1079'>1079</span>
<span id='1080'>1080</span>
<span id='1081'>1081</span>
<span id='1082'>1082</span>
<span id='1083'>1083</span>
<span id='1084'>1084</span>
<span id='1085'>1085</span>
<span id='1086'>1086</span>
<span id='1087'>1087</span>
<span id='1088'>1088</span>
<span id='1089'>1089</span>
<span id='1090'>1090</span>
<span id='1091'>1091</span>
<span id='1092'>1092</span>
<span id='1093'>1093</span>
<span id='1094'>1094</span>
<span id='1095'>1095</span>
<span id='1096'>1096</span>
<span id='1097'>1097</span>
<span id='1098'>1098</span>
<span id='1099'>1099</span>
<span id='1100'>1100</span>
<span id='1101'>1101</span>
<span id='1102'>1102</span>
<span id='1103'>1103</span>
<span id='1104'>1104</span>
<span id='1105'>1105</span>
<span id='1106'>1106</span>
<span id='1107'>1107</span>
<span id='1108'>1108</span>
</pre><pre class='rust '>
<span class='doccomment'>//! Types and utilities for working with headers in HTTP requests and responses.
</span><span class='doccomment'>//!
</span><span class='doccomment'>//! This HTTP system is Special in that it uses lots of strong typing for its header system. All
</span><span class='doccomment'>//! known HTTP headers are type checked, rather than being dealt with as strings all the time. Only
</span><span class='doccomment'>//! unknown headers are stored in a map in the traditional way.
</span>
<span class='kw'>use</span> <span class='ident'>url</span>::<span class='ident'>Url</span>;
<span class='kw'>use</span> <span class='ident'>std</span>::<span class='ident'>io</span>::<span class='ident'>IoResult</span>;
<span class='kw'>use</span> <span class='ident'>time</span>::{<span class='ident'>Tm</span>, <span class='ident'>strptime</span>};
<span class='kw'>use</span> <span class='ident'>rfc2616</span>::{<span class='ident'>is_token_item</span>, <span class='ident'>is_separator</span>, <span class='ident'>CR</span>, <span class='ident'>LF</span>, <span class='ident'>SP</span>, <span class='ident'>HT</span>, <span class='ident'>COLON</span>};
<span class='kw'>use</span> <span class='ident'>method</span>::<span class='ident'>Method</span>;

<span class='kw'>use</span> <span class='self'>self</span>::<span class='ident'>serialization_utils</span>::{<span class='ident'>normalise_header_name</span>};

<span class='kw'>pub</span> <span class='kw'>enum</span> <span class='ident'>HeaderLineErr</span> { <span class='ident'>EndOfFile</span>, <span class='ident'>EndOfHeaders</span>, <span class='ident'>MalformedHeaderValue</span>, <span class='ident'>MalformedHeaderSyntax</span> }

<span class='kw'>pub</span> <span class='kw'>mod</span> <span class='ident'>test_utils</span>;
<span class='kw'>pub</span> <span class='kw'>mod</span> <span class='ident'>serialization_utils</span>;<span class='comment'>

/* TODO: ensure we&#39;ve got all standard HTTP headers, not just those in RFC 2616.

From https://en.wikipedia.org/wiki/List_of_HTTP_headers:

- Known missing headers:

  - Access-Control-Allow-Origin
  - Content-Disposition
  - Link
  - P3P
  - Refresh
  - Set-Cookie
  - Status
  - Strict-Transport-Security

- Common non-standard headers:

  - X-Frame-Options
  - X-XSS-Protection
  - Content-Security-Policy, X-Content-Security-Policy, X-WebKit-CSP
  - X-Content-Type-Options
  - X-Powered-By
  - X-UA-Compatible

Also go through http://www.iana.org/assignments/message-headers/message-headers.xhtml which should
be the more canonical source.

*/

//pub mod accept;
//pub mod accept_charset;
//pub mod accept_encoding;
//pub mod accept_language;
</span><span class='kw'>pub</span> <span class='kw'>mod</span> <span class='ident'>accept_ranges</span>;<span class='comment'>
//pub mod cache_control;
</span><span class='kw'>pub</span> <span class='kw'>mod</span> <span class='ident'>connection</span>;<span class='comment'>
//pub mod content_encoding;
//pub mod content_range;
</span><span class='kw'>pub</span> <span class='kw'>mod</span> <span class='ident'>content_type</span>;
<span class='kw'>pub</span> <span class='kw'>mod</span> <span class='ident'>etag</span>;
<span class='kw'>pub</span> <span class='kw'>mod</span> <span class='ident'>host</span>;
<span class='kw'>pub</span> <span class='kw'>mod</span> <span class='ident'>transfer_encoding</span>;

<span class='kw'>pub</span> <span class='kw'>type</span> <span class='ident'>DeltaSeconds</span> <span class='op'>=</span> <span class='ident'>u64</span>;

<span class='attribute'>#[<span class='ident'>deriving</span>(<span class='ident'>Clone</span>, <span class='ident'>Eq</span>)]</span>
<span class='kw'>pub</span> <span class='kw'>enum</span> <span class='ident'>ConsumeCommaLWSResult</span> {
    <span class='ident'>CommaConsumed</span>,
    <span class='ident'>EndOfValue</span>,
    <span class='ident'>ErrCommaNotFound</span>,
}

<span class='kw'>pub</span> <span class='kw'>trait</span> <span class='ident'>HeaderEnum</span> {
    <span class='kw'>fn</span> <span class='ident'>header_name</span>(<span class='kw-2'>&amp;</span><span class='self'>self</span>) <span class='op'>-&gt;</span> <span class='kw-2'>~</span><span class='ident'>str</span>;
    <span class='kw'>fn</span> <span class='ident'>header_value</span>(<span class='kw-2'>&amp;</span><span class='self'>self</span>) <span class='op'>-&gt;</span> <span class='kw-2'>~</span><span class='ident'>str</span>;
    <span class='kw'>fn</span> <span class='ident'>write_header</span><span class='op'>&lt;</span><span class='ident'>W</span>: <span class='ident'>Writer</span><span class='op'>&gt;</span>(<span class='kw-2'>&amp;</span><span class='self'>self</span>, <span class='ident'>writer</span>: <span class='kw-2'>&amp;</span><span class='kw-2'>mut</span> <span class='ident'>W</span>) <span class='op'>-&gt;</span> <span class='ident'>IoResult</span><span class='op'>&lt;</span>()<span class='op'>&gt;</span>;<span class='comment'>

    // FIXME: this method combination is temporary, to be merged with an efficient parser like that
    // of the request line. Also refactor to remove the need to return the next byte too.
    </span><span class='doccomment'>/// Return values:
</span>    <span class='doccomment'>///
</span>    <span class='doccomment'>/// - Header
</span>    <span class='doccomment'>/// - Next byte (consumed out of linear white space checking necessity)
</span>    <span class='doccomment'>///
</span>    <span class='doccomment'>/// (Err, Option) means EOF/EOH/Malformed.
</span>    <span class='doccomment'>/// (Ok, None) is impossible.
</span>    <span class='doccomment'>/// (Ok, Some) means you have a valid header.
</span><span class='comment'>    //REMOVED BECAUSE OF ICE:
    //fn from_stream&lt;T: Reader&gt;(reader: &amp;mut T) -&gt; (Result&lt;Self, HeaderLineErr&gt;, Option&lt;u8&gt;) { ... }

    </span><span class='kw'>fn</span> <span class='ident'>value_from_stream</span><span class='op'>&lt;</span><span class='ident'>R</span>: <span class='ident'>Reader</span><span class='op'>&gt;</span>(<span class='ident'>name</span>: <span class='kw-2'>~</span><span class='ident'>str</span>, <span class='ident'>input</span>: <span class='kw-2'>&amp;</span><span class='kw-2'>mut</span> <span class='ident'>HeaderValueByteIterator</span><span class='op'>&lt;</span><span class='ident'>R</span><span class='op'>&gt;</span>)
        <span class='op'>-&gt;</span> <span class='prelude-ty'>Option</span><span class='op'>&lt;</span><span class='ident'>Self</span><span class='op'>&gt;</span>;
}

<span class='doccomment'>/// Shifted out of being a default method to fix an ICE (not yet reported, TODO)
</span><span class='kw'>pub</span> <span class='kw'>fn</span> <span class='ident'>header_enum_from_stream</span><span class='op'>&lt;</span><span class='ident'>R</span>: <span class='ident'>Reader</span>, <span class='ident'>E</span>: <span class='ident'>HeaderEnum</span><span class='op'>&gt;</span>(<span class='ident'>reader</span>: <span class='kw-2'>&amp;</span><span class='kw-2'>mut</span> <span class='ident'>R</span>)
        <span class='op'>-&gt;</span> (<span class='prelude-ty'>Result</span><span class='op'>&lt;</span><span class='ident'>E</span>, <span class='ident'>HeaderLineErr</span><span class='op'>&gt;</span>, <span class='prelude-ty'>Option</span><span class='op'>&lt;</span><span class='ident'>u8</span><span class='op'>&gt;</span>) {
    <span class='kw'>enum</span> <span class='ident'>State</span> { <span class='ident'>Start</span>, <span class='ident'>ReadingName</span>, <span class='ident'>NameFinished</span>, <span class='ident'>GotCR</span> }
    <span class='kw'>let</span> <span class='kw-2'>mut</span> <span class='ident'>state</span> <span class='op'>=</span> <span class='ident'>Start</span>;
    <span class='kw'>let</span> <span class='kw-2'>mut</span> <span class='ident'>header_name</span> <span class='op'>=</span> <span class='kw-2'>~</span><span class='string'>&quot;&quot;</span>;
    <span class='kw'>loop</span> {
        <span class='ident'>state</span> <span class='op'>=</span> <span class='kw'>match</span> (<span class='ident'>state</span>, <span class='ident'>reader</span>.<span class='ident'>read_byte</span>()) {
            (<span class='ident'>Start</span>, <span class='prelude-val'>Ok</span>(<span class='ident'>b</span>)) <span class='op'>|</span> (<span class='ident'>ReadingName</span>, <span class='prelude-val'>Ok</span>(<span class='ident'>b</span>)) <span class='kw'>if</span> <span class='ident'>is_token_item</span>(<span class='ident'>b</span>) <span class='op'>=&gt;</span> {
                <span class='ident'>header_name</span>.<span class='ident'>push_char</span>(<span class='ident'>b</span> <span class='kw'>as</span> <span class='ident'>char</span>);
                <span class='ident'>ReadingName</span>
            },<span class='comment'>
            // TODO: check up on the rules for a line like &quot;Name : value&quot;. Full LWS?
            </span>(<span class='ident'>Start</span>, <span class='prelude-val'>Ok</span>(<span class='ident'>b</span>)) <span class='kw'>if</span> <span class='ident'>b</span> <span class='op'>==</span> <span class='ident'>CR</span> <span class='op'>=&gt;</span> <span class='ident'>GotCR</span>,
            (<span class='ident'>Start</span>, <span class='prelude-val'>Ok</span>(<span class='ident'>b</span>)) <span class='op'>|</span> (<span class='ident'>GotCR</span>, <span class='prelude-val'>Ok</span>(<span class='ident'>b</span>)) <span class='kw'>if</span> <span class='ident'>b</span> <span class='op'>==</span> <span class='ident'>LF</span> <span class='op'>=&gt;</span> {
                <span class='kw'>return</span> (<span class='prelude-val'>Err</span>(<span class='ident'>EndOfHeaders</span>), <span class='prelude-val'>None</span>);
            },
            (_, <span class='prelude-val'>Ok</span>(<span class='ident'>b</span>)) <span class='kw'>if</span> <span class='ident'>b</span> <span class='op'>==</span> <span class='ident'>SP</span> <span class='op'>=&gt;</span> <span class='ident'>NameFinished</span>,
            (_, <span class='prelude-val'>Ok</span>(<span class='ident'>b</span>)) <span class='kw'>if</span> <span class='ident'>b</span> <span class='op'>==</span> <span class='ident'>COLON</span> <span class='op'>=&gt;</span> <span class='kw'>break</span>,
            (_, <span class='prelude-val'>Ok</span>(_)) <span class='op'>=&gt;</span> <span class='kw'>return</span> (<span class='prelude-val'>Err</span>(<span class='ident'>MalformedHeaderSyntax</span>), <span class='prelude-val'>None</span>),
            (_, <span class='prelude-val'>Err</span>(_)) <span class='op'>=&gt;</span> <span class='kw'>return</span> (<span class='prelude-val'>Err</span>(<span class='ident'>EndOfFile</span>), <span class='prelude-val'>None</span>),
        }
    }
    <span class='kw'>let</span> <span class='kw-2'>mut</span> <span class='ident'>iter</span> <span class='op'>=</span> <span class='ident'>HeaderValueByteIterator</span>::<span class='ident'>new</span>(<span class='ident'>reader</span>);
    <span class='kw'>let</span> <span class='ident'>header</span> <span class='op'>=</span> <span class='ident'>HeaderEnum</span>::<span class='ident'>value_from_stream</span>(<span class='ident'>normalise_header_name</span>(<span class='ident'>header_name</span>), <span class='kw-2'>&amp;</span><span class='kw-2'>mut</span> <span class='ident'>iter</span>);<span class='comment'>
    // Ensure that the entire header line is consumed (don&#39;t want to mess up next header!)
    </span><span class='kw'>for</span> _ <span class='kw'>in</span> <span class='ident'>iter</span> { }
    <span class='kw'>match</span> <span class='ident'>header</span> {
        <span class='prelude-val'>Some</span>(<span class='ident'>h</span>) <span class='op'>=&gt;</span> (<span class='prelude-val'>Ok</span>(<span class='ident'>h</span>), <span class='ident'>iter</span>.<span class='ident'>next_byte</span>),
        <span class='prelude-val'>None</span> <span class='op'>=&gt;</span> {
            <span class='macro'>debug</span><span class='macro'>!</span>(<span class='string'>&quot;malformed header value for {}&quot;</span>, <span class='ident'>header_name</span>);<span class='comment'>
            // Alas, I can&#39;t tell you what the value actually was... TODO: improve that situation
            </span>(<span class='prelude-val'>Err</span>(<span class='ident'>MalformedHeaderValue</span>), <span class='ident'>iter</span>.<span class='ident'>next_byte</span>)
        },
    }
}

<span class='attribute'>#[<span class='ident'>deriving</span>(<span class='ident'>Eq</span>)]</span>
<span class='kw'>enum</span> <span class='ident'>HeaderValueByteIteratorState</span> {
    <span class='ident'>Normal</span>,<span class='comment'>  // Anything other than the rest.
    </span><span class='ident'>GotLF</span>,<span class='comment'>  // Last character was LF (could be end of header or, if followed by SP or HT, LWS)
    </span><span class='ident'>Finished</span>,<span class='comment'>  // Finished, so next() should always return ``None`` immediately (no side effects)
</span>}

<span class='doccomment'>/// An iterator over the bytes of a header value.
</span><span class='doccomment'>/// This ensures one cannot read past the end of a header mistakenly and that linear white space is
</span><span class='doccomment'>/// handled correctly so that nothing else needs to worry about it. Any linear whitespace (multiple
</span><span class='doccomment'>/// spaces outside of a quoted-string) is compacted into a single SP.
</span><span class='kw'>pub</span> <span class='kw'>struct</span> <span class='ident'>HeaderValueByteIterator</span><span class='op'>&lt;</span><span class='lifetime'>&#39;a</span>, <span class='ident'>R</span><span class='op'>&gt;</span> {
    <span class='kw'>pub</span> <span class='ident'>reader</span>: <span class='kw-2'>&amp;</span><span class='lifetime'>&#39;a</span> <span class='kw-2'>mut</span> <span class='ident'>R</span>,

    <span class='doccomment'>/// This field serves two purposes. *During* iteration, it will typically be ``None``, but
</span>    <span class='doccomment'>/// certain cases will cause it to be a ``Some``, meaning that the next ``next()`` call will
</span>    <span class='doccomment'>/// return that value rather than reading a new byte. At the *end* of iteration (after
</span>    <span class='doccomment'>/// ``next()`` has returned ``None``), it will be the extra byte which it has had to consume
</span>    <span class='doccomment'>/// from the stream because of the possibility of linear white space of the form ``CR LF SP``.
</span>    <span class='doccomment'>/// It is guaranteed that if ``self.state == Finished`` this will be a ``Some``.
</span>    <span class='kw'>pub</span> <span class='ident'>next_byte</span>: <span class='prelude-ty'>Option</span><span class='op'>&lt;</span><span class='ident'>u8</span><span class='op'>&gt;</span>,

    <span class='kw'>pub</span> <span class='ident'>at_start</span>: <span class='ident'>bool</span>,
    <span class='ident'>state</span>: <span class='ident'>HeaderValueByteIteratorState</span>,
}

<span class='kw'>impl</span><span class='op'>&lt;</span><span class='lifetime'>&#39;a</span>, <span class='ident'>R</span>: <span class='ident'>Reader</span><span class='op'>&gt;</span> <span class='ident'>HeaderValueByteIterator</span><span class='op'>&lt;</span><span class='lifetime'>&#39;a</span>, <span class='ident'>R</span><span class='op'>&gt;</span> {

    <span class='kw'>pub</span> <span class='kw'>fn</span> <span class='ident'>new</span>(<span class='ident'>reader</span>: <span class='kw-2'>&amp;</span><span class='lifetime'>&#39;a</span> <span class='kw-2'>mut</span> <span class='ident'>R</span>) <span class='op'>-&gt;</span> <span class='ident'>HeaderValueByteIterator</span><span class='op'>&lt;</span><span class='lifetime'>&#39;a</span>, <span class='ident'>R</span><span class='op'>&gt;</span> {
        <span class='ident'>HeaderValueByteIterator</span> {
            <span class='ident'>reader</span>: <span class='ident'>reader</span>,
            <span class='ident'>next_byte</span>: <span class='prelude-val'>None</span>,
            <span class='ident'>at_start</span>: <span class='boolval'>true</span>,
            <span class='ident'>state</span>: <span class='ident'>Normal</span>,
        }
    }

    <span class='doccomment'>/// Check that the entire header value has been consumed.
</span>    <span class='doccomment'>///
</span>    <span class='doccomment'>/// Should there be any trailing linear white space, it is dropped.
</span>    <span class='doccomment'>///
</span>    <span class='doccomment'>/// Be cautious using this function as it is destructive, losing a character in the case where
</span>    <span class='doccomment'>/// the value has not been entirely consumed.
</span>    <span class='doccomment'>///
</span>    <span class='doccomment'>/// This should only be called when finished with a value and ensuring that there aren&#39;t
</span>    <span class='doccomment'>/// unexpected characters
</span>    <span class='doccomment'>///
</span>    <span class='doccomment'>/// Suggested usage is in a ``from_stream`` method::
</span>    <span class='doccomment'>///
</span>    <span class='doccomment'>///     if reader.verify_consumed() {
</span>    <span class='doccomment'>///         Some(header)
</span>    <span class='doccomment'>///     } else {
</span>    <span class='doccomment'>///         None
</span>    <span class='doccomment'>///     }
</span>    <span class='doccomment'>///
</span>    <span class='doccomment'>/// ... however, this common case is handled with the ``some_if_consumed`` method, so you may
</span>    <span class='doccomment'>/// very well not need to call this function directly.
</span>    <span class='attribute'>#[<span class='ident'>inline</span>]</span>
    <span class='kw'>pub</span> <span class='kw'>fn</span> <span class='ident'>verify_consumed</span>(<span class='kw-2'>&amp;</span><span class='kw-2'>mut</span> <span class='self'>self</span>) <span class='op'>-&gt;</span> <span class='ident'>bool</span> {
        <span class='self'>self</span>.<span class='ident'>consume_optional_lws</span>();
        <span class='self'>self</span>.<span class='ident'>next</span>() <span class='op'>==</span> <span class='prelude-val'>None</span>
    }

    <span class='doccomment'>/// Turn a constructed header value into an Option: Some(value) if the header value is consumed
</span>    <span class='doccomment'>/// or None if it is not, thus indicating: &quot;I&#39;m finished and expect nothing more. Anything more
</span>    <span class='doccomment'>/// is an error.&quot;
</span>    <span class='attribute'>#[<span class='ident'>inline</span>]</span>
    <span class='kw'>pub</span> <span class='kw'>fn</span> <span class='ident'>some_if_consumed</span><span class='op'>&lt;</span><span class='ident'>T</span><span class='op'>&gt;</span>(<span class='kw-2'>&amp;</span><span class='kw-2'>mut</span> <span class='self'>self</span>, <span class='ident'>t</span>: <span class='ident'>T</span>) <span class='op'>-&gt;</span> <span class='prelude-ty'>Option</span><span class='op'>&lt;</span><span class='ident'>T</span><span class='op'>&gt;</span> {
        <span class='kw'>if</span> <span class='self'>self</span>.<span class='ident'>verify_consumed</span>() {
            <span class='prelude-val'>Some</span>(<span class='ident'>t</span>)
        } <span class='kw'>else</span> {
            <span class='prelude-val'>None</span>
        }
    }<span class='comment'>

    // TODO: can we have collect() implemented for ~str? That would negate the need for this.
    </span><span class='kw'>fn</span> <span class='ident'>collect_to_str</span>(<span class='kw-2'>&amp;</span><span class='kw-2'>mut</span> <span class='self'>self</span>) <span class='op'>-&gt;</span> <span class='kw-2'>~</span><span class='ident'>str</span> {<span class='comment'>
        // TODO: be more efficient (char cast is a little unnecessary)
        </span><span class='kw'>let</span> <span class='kw-2'>mut</span> <span class='ident'>out</span> <span class='op'>=</span> <span class='kw-2'>~</span><span class='string'>&quot;&quot;</span>;<span class='comment'>
        // No point in trying out.reserve(self.size_hint()); I *know* I can&#39;t offer a useful hint.
        </span><span class='kw'>loop</span> {
            <span class='kw'>match</span> <span class='self'>self</span>.<span class='ident'>next</span>() {
                <span class='prelude-val'>None</span> <span class='op'>=&gt;</span> <span class='kw'>break</span>,
                <span class='prelude-val'>Some</span>(<span class='ident'>b</span>) <span class='op'>=&gt;</span> <span class='ident'>out</span>.<span class='ident'>push_char</span>(<span class='ident'>b</span> <span class='kw'>as</span> <span class='ident'>char</span>),
            }
        }<span class='comment'>
        /*Doesn&#39;t work: &quot;cannot borrow immutable self value as mutable&quot; (!! TODO: report bug)
        for b in self {
            out.push_char(b as char);
        }*/
        </span><span class='ident'>out</span>
    }

    <span class='doccomment'>/**
     * Consume optional `*LWS`. That is, zero or more of SP and HT, until it
     * gets to something other than SP and HT or gets to the end of the header.
     */
</span>    <span class='kw'>pub</span> <span class='kw'>fn</span> <span class='ident'>consume_optional_lws</span>(<span class='kw-2'>&amp;</span><span class='kw-2'>mut</span> <span class='self'>self</span>) {<span class='comment'>
        // This is the dirty secret of this method.
        </span><span class='kw'>let</span> _ <span class='op'>=</span> <span class='self'>self</span>.<span class='ident'>consume_lws</span>();
    }

    <span class='doccomment'>/**
     * Consume `1*LWS`. That is, one or more of SP and HT, until it gets to
     * something other than SP and HT or gets to the end of the header.
     */
</span>    <span class='kw'>pub</span> <span class='kw'>fn</span> <span class='ident'>consume_lws</span>(<span class='kw-2'>&amp;</span><span class='kw-2'>mut</span> <span class='self'>self</span>) <span class='op'>-&gt;</span> <span class='ident'>bool</span> {<span class='comment'>
        // This doesn&#39;t need to deal with CR and LF; next() collapses that LWS.
        // (This Serious Comment had to come here rather than lower where it would normally be more
        // suitable as it would otherwise have messed up the poetry of the Less Serious Comments.)

        // Don&#39;t you love descriptive variable names?
        </span><span class='kw'>let</span> <span class='kw-2'>mut</span> <span class='ident'>the_savages_gobbled_up_at_least_one_white_space_char</span> <span class='op'>=</span> <span class='boolval'>false</span>;
        <span class='kw'>loop</span> {<span class='comment'>
            // 1000 hairy (?) white space chars, sitting in a stream...
            </span><span class='kw'>match</span> <span class='self'>self</span>.<span class='ident'>next</span>() {<span class='comment'>
                // Gobble, gobble, glup, glup, much, munch, munch.
                </span><span class='prelude-val'>Some</span>(<span class='ident'>b</span>) <span class='kw'>if</span> <span class='ident'>b</span> <span class='op'>==</span> <span class='ident'>SP</span> <span class='op'>||</span> <span class='ident'>b</span> <span class='op'>==</span> <span class='ident'>HT</span> <span class='op'>=&gt;</span> (),
                <span class='prelude-val'>Some</span>(<span class='ident'>b</span>) <span class='op'>=&gt;</span> {<span class='comment'>
                    // &quot;Oy! Who put a non-white-space-char on my plate?&quot;
                    // Better take it off or someone might eat it by accident...
                    </span><span class='macro'>assert_eq</span><span class='macro'>!</span>(<span class='self'>self</span>.<span class='ident'>next_byte</span>, <span class='prelude-val'>None</span>);<span class='comment'>  // TODO: manually verify this holds
                    </span><span class='self'>self</span>.<span class='ident'>next_byte</span> <span class='op'>=</span> <span class='prelude-val'>Some</span>(<span class='ident'>b</span>);
                    <span class='kw'>break</span>;
                },
                <span class='prelude-val'>None</span> <span class='op'>=&gt;</span> <span class='kw'>break</span>,<span class='comment'>  // Sorry, you&#39;re going to go hungry today...
            </span>};
            <span class='ident'>the_savages_gobbled_up_at_least_one_white_space_char</span> <span class='op'>=</span> <span class='boolval'>true</span>;
        }
        <span class='ident'>the_savages_gobbled_up_at_least_one_white_space_char</span>
    }

    <span class='doccomment'>/// Return values:
</span>    <span class='doccomment'>/// - CommaConsumed if there was a comma and it was consumed;
</span>    <span class='doccomment'>/// - EndOfValue if the header value has been completely consumed;
</span>    <span class='doccomment'>/// - ErrCommaNotFound if the next thing wasn&#39;t a comma (this is an error state)
</span>    <span class='kw'>pub</span> <span class='kw'>fn</span> <span class='ident'>consume_comma_lws</span>(<span class='kw-2'>&amp;</span><span class='kw-2'>mut</span> <span class='self'>self</span>) <span class='op'>-&gt;</span> <span class='ident'>ConsumeCommaLWSResult</span> {
        <span class='self'>self</span>.<span class='ident'>consume_optional_lws</span>();
        <span class='kw'>match</span> <span class='self'>self</span>.<span class='ident'>next</span>() {
            <span class='prelude-val'>Some</span>(<span class='ident'>b</span>) <span class='kw'>if</span> <span class='ident'>b</span> <span class='op'>==</span> <span class='string'>&#39;,&#39;</span> <span class='kw'>as</span> <span class='ident'>u8</span> <span class='op'>=&gt;</span> {
                <span class='self'>self</span>.<span class='ident'>consume_optional_lws</span>();
                <span class='ident'>CommaConsumed</span>
            },
            <span class='prelude-val'>Some</span>(_) <span class='op'>=&gt;</span> {
                <span class='ident'>ErrCommaNotFound</span>
            },
            <span class='prelude-val'>None</span> <span class='op'>=&gt;</span> {
                <span class='ident'>EndOfValue</span>
            }
        }
    }

    <span class='doccomment'>/// Read a quoted-string from the current position.
</span>    <span class='doccomment'>/// If the quoted-string is not begun immediately or the header ends before it is completed,
</span>    <span class='doccomment'>/// then None is returned; TODO: decide if I can return the bytes read (at present, escapes and
</span>    <span class='doccomment'>/// double quote would be lost if I did that).
</span>    <span class='kw'>pub</span> <span class='kw'>fn</span> <span class='ident'>read_quoted_string</span>(<span class='kw-2'>&amp;</span><span class='kw-2'>mut</span> <span class='self'>self</span>, <span class='ident'>already_opened</span>: <span class='ident'>bool</span>) <span class='op'>-&gt;</span> <span class='prelude-ty'>Option</span><span class='op'>&lt;</span><span class='kw-2'>~</span><span class='ident'>str</span><span class='op'>&gt;</span> {
        <span class='kw'>enum</span> <span class='ident'>State</span> { <span class='ident'>Start</span>, <span class='ident'>Normal</span>, <span class='ident'>Escaping</span> }

        <span class='kw'>let</span> <span class='kw-2'>mut</span> <span class='ident'>state</span> <span class='op'>=</span> <span class='kw'>if</span> <span class='ident'>already_opened</span> { <span class='ident'>Normal</span> } <span class='kw'>else</span> { <span class='ident'>Start</span> };
        <span class='kw'>let</span> <span class='kw-2'>mut</span> <span class='ident'>output</span> <span class='op'>=</span> <span class='kw-2'>~</span><span class='string'>&quot;&quot;</span>;
        <span class='kw'>loop</span> {
            <span class='kw'>match</span> <span class='self'>self</span>.<span class='ident'>next</span>() {
                <span class='prelude-val'>None</span> <span class='op'>=&gt;</span> <span class='kw'>return</span> <span class='prelude-val'>None</span>,
                <span class='prelude-val'>Some</span>(<span class='ident'>b</span>) <span class='op'>=&gt;</span> {
                    <span class='ident'>state</span> <span class='op'>=</span> <span class='kw'>match</span> <span class='ident'>state</span> {
                        <span class='ident'>Start</span> <span class='kw'>if</span> <span class='ident'>b</span> <span class='op'>==</span> <span class='string'>&#39;&quot;&#39;</span> <span class='kw'>as</span> <span class='ident'>u8</span> <span class='op'>=&gt;</span> <span class='ident'>Normal</span>,
                        <span class='ident'>Start</span> <span class='op'>=&gt;</span> <span class='kw'>return</span> <span class='prelude-val'>None</span>,
                        <span class='ident'>Normal</span> <span class='kw'>if</span> <span class='ident'>b</span> <span class='op'>==</span> <span class='string'>&#39;\\&#39;</span> <span class='kw'>as</span> <span class='ident'>u8</span> <span class='op'>=&gt;</span> <span class='ident'>Escaping</span>,
                        <span class='ident'>Normal</span> <span class='kw'>if</span> <span class='ident'>b</span> <span class='op'>==</span> <span class='string'>&#39;&quot;&#39;</span> <span class='kw'>as</span> <span class='ident'>u8</span> <span class='op'>=&gt;</span> <span class='kw'>break</span>,
                        <span class='ident'>Normal</span> <span class='op'>|</span> <span class='ident'>Escaping</span> <span class='op'>=&gt;</span> { <span class='ident'>output</span>.<span class='ident'>push_char</span>(<span class='ident'>b</span> <span class='kw'>as</span> <span class='ident'>char</span>); <span class='ident'>Normal</span> },
                    }
                }
            }
        }
        <span class='prelude-val'>Some</span>(<span class='ident'>output</span>)
    }

    <span class='kw'>fn</span> <span class='ident'>read_parameter</span>(<span class='kw-2'>&amp;</span><span class='kw-2'>mut</span> <span class='self'>self</span>, <span class='ident'>already_read_semicolon</span>: <span class='ident'>bool</span>) <span class='op'>-&gt;</span> <span class='prelude-ty'>Option</span><span class='op'>&lt;</span>(<span class='kw-2'>~</span><span class='ident'>str</span>, <span class='kw-2'>~</span><span class='ident'>str</span>)<span class='op'>&gt;</span> {
        <span class='kw'>if</span> <span class='op'>!</span><span class='ident'>already_read_semicolon</span> <span class='op'>&amp;&amp;</span> <span class='self'>self</span>.<span class='ident'>next</span>() <span class='op'>!=</span> <span class='prelude-val'>Some</span>(<span class='string'>&#39;;&#39;</span> <span class='kw'>as</span> <span class='ident'>u8</span>) {
            <span class='kw'>return</span> <span class='prelude-val'>None</span>;
        }
        <span class='self'>self</span>.<span class='ident'>consume_optional_lws</span>();
        <span class='kw'>let</span> <span class='ident'>key</span> <span class='op'>=</span> <span class='kw'>match</span> <span class='self'>self</span>.<span class='ident'>read_token</span>() {
            <span class='prelude-val'>Some</span>(<span class='ident'>t</span>) <span class='op'>=&gt;</span> <span class='ident'>t</span>,
            <span class='prelude-val'>None</span> <span class='op'>=&gt;</span> <span class='kw'>return</span> <span class='prelude-val'>None</span>,
        };
        <span class='self'>self</span>.<span class='ident'>consume_optional_lws</span>();
        <span class='kw'>if</span> <span class='self'>self</span>.<span class='ident'>next</span>() <span class='op'>!=</span> <span class='prelude-val'>Some</span>(<span class='string'>&#39;=&#39;</span> <span class='kw'>as</span> <span class='ident'>u8</span>) {
            <span class='kw'>return</span> <span class='prelude-val'>None</span>;
        }
        <span class='self'>self</span>.<span class='ident'>consume_optional_lws</span>();
        <span class='kw'>let</span> <span class='ident'>value</span> <span class='op'>=</span> <span class='kw'>match</span> <span class='self'>self</span>.<span class='ident'>read_token_or_quoted_string</span>() {
            <span class='prelude-val'>Some</span>(<span class='ident'>t</span>) <span class='op'>=&gt;</span> <span class='ident'>t</span>,
            <span class='prelude-val'>None</span> <span class='op'>=&gt;</span> <span class='kw'>return</span> <span class='prelude-val'>None</span>,
        };
        <span class='self'>self</span>.<span class='ident'>consume_optional_lws</span>();
        <span class='prelude-val'>Some</span>((<span class='ident'>key</span>, <span class='ident'>value</span>))
    }

    <span class='doccomment'>/// Read parameters from the current position.
</span>    <span class='doccomment'>///
</span>    <span class='doccomment'>/// The return value ``None`` is reserved for syntax errors in parameters that exist; a mere
</span>    <span class='doccomment'>/// absense of parameters will lead to returning an empty vector instead.
</span>    <span class='kw'>fn</span> <span class='ident'>read_parameters</span>(<span class='kw-2'>&amp;</span><span class='kw-2'>mut</span> <span class='self'>self</span>) <span class='op'>-&gt;</span> <span class='prelude-ty'>Option</span><span class='op'>&lt;</span><span class='ident'>Vec</span><span class='op'>&lt;</span>(<span class='kw-2'>~</span><span class='ident'>str</span>, <span class='kw-2'>~</span><span class='ident'>str</span>)<span class='op'>&gt;&gt;</span> {
        <span class='kw'>let</span> <span class='kw-2'>mut</span> <span class='ident'>result</span> <span class='op'>=</span> <span class='ident'>Vec</span>::<span class='ident'>new</span>();
        <span class='kw'>loop</span> {
            <span class='kw'>match</span> <span class='self'>self</span>.<span class='ident'>next</span>() {<span class='comment'>
                //This catches the LWS after the last &#39;;&#39;, and can probably be replaced with
                //consume_optional_lws().
                </span><span class='prelude-val'>Some</span>(<span class='ident'>b</span>) <span class='kw'>if</span> <span class='ident'>b</span> <span class='op'>==</span> <span class='ident'>SP</span> <span class='op'>||</span> <span class='ident'>b</span> <span class='op'>==</span> <span class='ident'>HT</span> <span class='op'>=&gt;</span> (),
                <span class='prelude-val'>Some</span>(<span class='ident'>b</span>) <span class='kw'>if</span> <span class='ident'>b</span> <span class='op'>==</span> <span class='string'>&#39;;&#39;</span> <span class='kw'>as</span> <span class='ident'>u8</span> <span class='op'>=&gt;</span> {
                    <span class='kw'>match</span> <span class='self'>self</span>.<span class='ident'>read_parameter</span>(<span class='boolval'>true</span>) {
                        <span class='prelude-val'>Some</span>(<span class='ident'>parameter</span>) <span class='op'>=&gt;</span> <span class='ident'>result</span>.<span class='ident'>push</span>(<span class='ident'>parameter</span>),
                        <span class='prelude-val'>None</span> <span class='op'>=&gt;</span> <span class='kw'>return</span> <span class='prelude-val'>None</span>,
                    }
                },
                <span class='prelude-val'>Some</span>(<span class='ident'>b</span>) <span class='op'>=&gt;</span> {<span class='comment'>
                    // TODO: manually prove this; can LWS trip it up?
                    </span><span class='macro'>assert_eq</span><span class='macro'>!</span>(<span class='self'>self</span>.<span class='ident'>next_byte</span>, <span class='prelude-val'>None</span>);
                    <span class='self'>self</span>.<span class='ident'>next_byte</span> <span class='op'>=</span> <span class='prelude-val'>Some</span>(<span class='ident'>b</span>);
                    <span class='kw'>return</span> <span class='prelude-val'>Some</span>(<span class='ident'>result</span>);
                },
                <span class='prelude-val'>None</span> <span class='op'>=&gt;</span> <span class='kw'>return</span> <span class='prelude-val'>Some</span>(<span class='ident'>result</span>),
            }
        }
    }

    <span class='doccomment'>/// Read a token (RFC 2616 definition) from the header value.
</span>    <span class='doccomment'>///
</span>    <span class='doccomment'>/// If no token begins at the current point of the header, ``None`` will also be returned.
</span>    <span class='kw'>pub</span> <span class='kw'>fn</span> <span class='ident'>read_token_or_quoted_string</span>(<span class='kw-2'>&amp;</span><span class='kw-2'>mut</span> <span class='self'>self</span>) <span class='op'>-&gt;</span> <span class='prelude-ty'>Option</span><span class='op'>&lt;</span><span class='kw-2'>~</span><span class='ident'>str</span><span class='op'>&gt;</span> {

        <span class='kw'>let</span> <span class='kw-2'>mut</span> <span class='ident'>output</span> <span class='op'>=</span> <span class='kw-2'>~</span><span class='string'>&quot;&quot;</span>;
        <span class='kw'>match</span> <span class='self'>self</span>.<span class='ident'>next</span>() {
            <span class='prelude-val'>Some</span>(<span class='ident'>b</span>) <span class='kw'>if</span> <span class='ident'>b</span> <span class='op'>==</span> <span class='string'>&#39;&quot;&#39;</span> <span class='kw'>as</span> <span class='ident'>u8</span> <span class='op'>=&gt;</span> {<span class='comment'>
                // It is a quoted-string.
                </span><span class='kw'>enum</span> <span class='ident'>State</span> { <span class='ident'>Normal</span>, <span class='ident'>Escaping</span> }
                <span class='kw'>let</span> <span class='kw-2'>mut</span> <span class='ident'>state</span> <span class='op'>=</span> <span class='ident'>Normal</span>;
                <span class='kw'>loop</span> {
                    <span class='kw'>match</span> <span class='self'>self</span>.<span class='ident'>next</span>() {
                        <span class='prelude-val'>None</span> <span class='op'>=&gt;</span> <span class='kw'>return</span> <span class='prelude-val'>None</span>,
                        <span class='prelude-val'>Some</span>(<span class='ident'>b</span>) <span class='op'>=&gt;</span> <span class='ident'>state</span> <span class='op'>=</span> <span class='kw'>match</span> <span class='ident'>state</span> {
                            <span class='ident'>Normal</span> <span class='kw'>if</span> <span class='ident'>b</span> <span class='op'>==</span> <span class='string'>&#39;\\&#39;</span> <span class='kw'>as</span> <span class='ident'>u8</span> <span class='op'>=&gt;</span> <span class='ident'>Escaping</span>,
                            <span class='ident'>Normal</span> <span class='kw'>if</span> <span class='ident'>b</span> <span class='op'>==</span> <span class='string'>&#39;&quot;&#39;</span> <span class='kw'>as</span> <span class='ident'>u8</span> <span class='op'>=&gt;</span> <span class='kw'>break</span>,
                            <span class='ident'>Normal</span> <span class='op'>|</span> <span class='ident'>Escaping</span> <span class='op'>=&gt;</span> { <span class='ident'>output</span>.<span class='ident'>push_char</span>(<span class='ident'>b</span> <span class='kw'>as</span> <span class='ident'>char</span>); <span class='ident'>Normal</span> },
                        }
                    }
                }
                <span class='kw'>return</span> <span class='prelude-val'>Some</span>(<span class='ident'>output</span>);
            },
            <span class='prelude-val'>Some</span>(<span class='ident'>b</span>) <span class='op'>=&gt;</span> <span class='self'>self</span>.<span class='ident'>next_byte</span> <span class='op'>=</span> <span class='prelude-val'>Some</span>(<span class='ident'>b</span>),
            <span class='prelude-val'>None</span> <span class='op'>=&gt;</span> <span class='kw'>return</span> <span class='prelude-val'>None</span>,
        }<span class='comment'>
        // OK, it wasn&#39;t a quoted-string. Must be a token.
        </span><span class='kw'>loop</span> {
            <span class='kw'>match</span> <span class='self'>self</span>.<span class='ident'>next</span>() {
                <span class='prelude-val'>None</span> <span class='op'>=&gt;</span> <span class='kw'>break</span>,
                <span class='prelude-val'>Some</span>(<span class='ident'>b</span>) <span class='kw'>if</span> <span class='ident'>is_separator</span>(<span class='ident'>b</span>) <span class='op'>=&gt;</span> {
                    <span class='macro'>assert_eq</span><span class='macro'>!</span>(<span class='self'>self</span>.<span class='ident'>next_byte</span>, <span class='prelude-val'>None</span>);
                    <span class='self'>self</span>.<span class='ident'>next_byte</span> <span class='op'>=</span> <span class='prelude-val'>Some</span>(<span class='ident'>b</span>);
                    <span class='kw'>break</span>;
                },
                <span class='prelude-val'>Some</span>(<span class='ident'>b</span>) <span class='kw'>if</span> <span class='ident'>is_token_item</span>(<span class='ident'>b</span>) <span class='op'>=&gt;</span> {
                    <span class='ident'>output</span>.<span class='ident'>push_char</span>(<span class='ident'>b</span> <span class='kw'>as</span> <span class='ident'>char</span>);
                },
                <span class='prelude-val'>Some</span>(<span class='ident'>b</span>) <span class='op'>=&gt;</span> {
                    <span class='macro'>println</span><span class='macro'>!</span>(<span class='string'>&quot;TODO: what should be done with a token ended with a non-separator? \
(With token {}, {} was read.)&quot;</span>, <span class='ident'>output</span>, <span class='ident'>b</span> <span class='kw'>as</span> <span class='ident'>char</span>);
                }
            }
        }
        <span class='kw'>if</span> <span class='ident'>output</span>.<span class='ident'>len</span>() <span class='op'>==</span> <span class='number'>0</span> {
            <span class='prelude-val'>None</span>
        } <span class='kw'>else</span> {
            <span class='prelude-val'>Some</span>(<span class='ident'>output</span>)
        }
    }

    <span class='doccomment'>/// Read a token (RFC 2616 definition) from the header value.
</span>    <span class='doccomment'>///
</span>    <span class='doccomment'>/// If no token begins at the current point of the header, ``None`` will also be returned.
</span>    <span class='kw'>pub</span> <span class='kw'>fn</span> <span class='ident'>read_token</span>(<span class='kw-2'>&amp;</span><span class='kw-2'>mut</span> <span class='self'>self</span>) <span class='op'>-&gt;</span> <span class='prelude-ty'>Option</span><span class='op'>&lt;</span><span class='kw-2'>~</span><span class='ident'>str</span><span class='op'>&gt;</span> {
        <span class='kw'>let</span> <span class='kw-2'>mut</span> <span class='ident'>output</span> <span class='op'>=</span> <span class='kw-2'>~</span><span class='string'>&quot;&quot;</span>;
        <span class='kw'>loop</span> {
            <span class='kw'>match</span> <span class='self'>self</span>.<span class='ident'>next</span>() {
                <span class='prelude-val'>None</span> <span class='op'>=&gt;</span> <span class='kw'>break</span>,
                <span class='prelude-val'>Some</span>(<span class='ident'>b</span>) <span class='kw'>if</span> <span class='ident'>is_separator</span>(<span class='ident'>b</span>) <span class='op'>=&gt;</span> {
                    <span class='macro'>assert_eq</span><span class='macro'>!</span>(<span class='self'>self</span>.<span class='ident'>next_byte</span>, <span class='prelude-val'>None</span>);
                    <span class='self'>self</span>.<span class='ident'>next_byte</span> <span class='op'>=</span> <span class='prelude-val'>Some</span>(<span class='ident'>b</span>);
                    <span class='kw'>break</span>;
                },
                <span class='prelude-val'>Some</span>(<span class='ident'>b</span>) <span class='kw'>if</span> <span class='ident'>is_token_item</span>(<span class='ident'>b</span>) <span class='op'>=&gt;</span> {
                    <span class='ident'>output</span>.<span class='ident'>push_char</span>(<span class='ident'>b</span> <span class='kw'>as</span> <span class='ident'>char</span>);
                },
                <span class='prelude-val'>Some</span>(<span class='ident'>b</span>) <span class='op'>=&gt;</span> {
                    <span class='macro'>println</span><span class='macro'>!</span>(<span class='string'>&quot;TODO: what should be done with a token ended with a non-separator? \
(With token {:?}, {:?} was read.)&quot;</span>, <span class='ident'>output</span>, <span class='ident'>b</span> <span class='kw'>as</span> <span class='ident'>char</span>);
                }
            }
        }
        <span class='kw'>if</span> <span class='ident'>output</span>.<span class='ident'>len</span>() <span class='op'>==</span> <span class='number'>0</span> {
            <span class='prelude-val'>None</span>
        } <span class='kw'>else</span> {
            <span class='prelude-val'>Some</span>(<span class='ident'>output</span>)
        }
    }
}

<span class='kw'>impl</span><span class='op'>&lt;</span><span class='lifetime'>&#39;a</span>, <span class='ident'>R</span>: <span class='ident'>Reader</span><span class='op'>&gt;</span> <span class='ident'>Iterator</span><span class='op'>&lt;</span><span class='ident'>u8</span><span class='op'>&gt;</span> <span class='kw'>for</span> <span class='ident'>HeaderValueByteIterator</span><span class='op'>&lt;</span><span class='lifetime'>&#39;a</span>, <span class='ident'>R</span><span class='op'>&gt;</span> {
    <span class='kw'>fn</span> <span class='ident'>next</span>(<span class='kw-2'>&amp;</span><span class='kw-2'>mut</span> <span class='self'>self</span>) <span class='op'>-&gt;</span> <span class='prelude-ty'>Option</span><span class='op'>&lt;</span><span class='ident'>u8</span><span class='op'>&gt;</span> {
        <span class='kw'>if</span> <span class='self'>self</span>.<span class='ident'>state</span> <span class='op'>==</span> <span class='ident'>Finished</span> {
            <span class='kw'>return</span> <span class='prelude-val'>None</span>;
        }
        <span class='kw'>loop</span> {
            <span class='kw'>let</span> <span class='ident'>b</span> <span class='op'>=</span> <span class='kw'>match</span> <span class='self'>self</span>.<span class='ident'>next_byte</span> {
                <span class='prelude-val'>Some</span>(<span class='ident'>b</span>) <span class='op'>=&gt;</span> {
                    <span class='self'>self</span>.<span class='ident'>next_byte</span> <span class='op'>=</span> <span class='prelude-val'>None</span>;
                    <span class='ident'>b</span>
                },
                <span class='prelude-val'>None</span> <span class='op'>=&gt;</span> <span class='kw'>match</span> <span class='self'>self</span>.<span class='ident'>reader</span>.<span class='ident'>read_byte</span>() {
                    <span class='prelude-val'>Err</span>(_) <span class='op'>=&gt;</span> {<span class='comment'>
                        // Probably EOF; not a friendly reader :-(.
                        // Let&#39;s just call that the end. And sorry—your IoError
                        // is being concealed. Such is life with Iterator.
                        </span><span class='self'>self</span>.<span class='ident'>state</span> <span class='op'>=</span> <span class='ident'>Finished</span>;
                        <span class='kw'>return</span> <span class='prelude-val'>None</span>
                    },
                    <span class='prelude-val'>Ok</span>(<span class='ident'>b</span>) <span class='op'>=&gt;</span> <span class='ident'>b</span>,
                }
            };
            <span class='kw'>match</span> <span class='self'>self</span>.<span class='ident'>state</span> {
                <span class='ident'>Normal</span> <span class='kw'>if</span> <span class='ident'>b</span> <span class='op'>==</span> <span class='ident'>SP</span> <span class='op'>||</span> <span class='ident'>b</span> <span class='op'>==</span> <span class='ident'>HT</span> <span class='op'>=&gt;</span> {
                    <span class='kw'>if</span> <span class='self'>self</span>.<span class='ident'>at_start</span> {
                        <span class='kw'>continue</span>;
                    } <span class='kw'>else</span> {
                        <span class='kw'>return</span> <span class='prelude-val'>Some</span>(<span class='ident'>b</span>);
                    }
                },
                <span class='ident'>Normal</span> <span class='kw'>if</span> <span class='ident'>b</span> <span class='op'>==</span> <span class='ident'>CR</span> <span class='op'>=&gt;</span> {<span class='comment'>
                    // RFC 2616 section 19.3, paragraph 3: &quot;The line terminator for message-header
                    // fields is the sequence CRLF. However, we recommend that applications, when
                    // parsing such headers, recognize a single LF as a line terminator and ignore
                    // the leading CR.&quot;
                    </span><span class='kw'>continue</span>;
                },
                <span class='ident'>Normal</span> <span class='kw'>if</span> <span class='ident'>b</span> <span class='op'>==</span> <span class='ident'>LF</span> <span class='op'>=&gt;</span> {
                    <span class='self'>self</span>.<span class='ident'>state</span> <span class='op'>=</span> <span class='ident'>GotLF</span>;
                    <span class='kw'>continue</span>;
                },
                <span class='ident'>GotLF</span> <span class='kw'>if</span> <span class='ident'>b</span> <span class='op'>==</span> <span class='ident'>SP</span> <span class='op'>||</span> <span class='ident'>b</span> <span class='op'>==</span> <span class='ident'>HT</span> <span class='op'>=&gt;</span> {<span class='comment'>
                    // This isn&#39;t an end of header, this is LWS.
                    //
                    // RFC 2616, section 2.2:
                    //
                    //     LWS            = [CRLF] 1*( SP | HT )
                    //
                    // RFC 2616, section 4.2, paragraph 1:
                    //
                    //     Header fields can be extended over multiple lines by
                    //     preceding each extra line with at least one SP or HT.

                    </span><span class='self'>self</span>.<span class='ident'>state</span> <span class='op'>=</span> <span class='ident'>Normal</span>;
                    <span class='kw'>return</span> <span class='prelude-val'>Some</span>(<span class='ident'>b</span>);
                },
                <span class='ident'>GotLF</span> <span class='op'>=&gt;</span> {<span class='comment'>
                    // Ooh! We got to a genuine end of line, so we&#39;re done.
                    // But first, we must makes sure not to lose that byte.
                    </span><span class='self'>self</span>.<span class='ident'>next_byte</span> <span class='op'>=</span> <span class='prelude-val'>Some</span>(<span class='ident'>b</span>);
                    <span class='self'>self</span>.<span class='ident'>state</span> <span class='op'>=</span> <span class='ident'>Finished</span>;
                    <span class='kw'>return</span> <span class='prelude-val'>None</span>;
                },
                <span class='ident'>Normal</span> <span class='op'>=&gt;</span> {
                    <span class='self'>self</span>.<span class='ident'>at_start</span> <span class='op'>=</span> <span class='boolval'>false</span>;
                    <span class='kw'>return</span> <span class='prelude-val'>Some</span>(<span class='ident'>b</span>);
                },
                <span class='ident'>Finished</span> <span class='op'>=&gt;</span> <span class='macro'>unreachable</span><span class='macro'>!</span>(),
            }
        }
    }
}

<span class='doccomment'>/**
 * A datatype for headers.
 */
</span><span class='kw'>pub</span> <span class='kw'>trait</span> <span class='ident'>HeaderConvertible</span>: <span class='ident'>Eq</span> <span class='op'>+</span> <span class='ident'>Clone</span> {
    <span class='doccomment'>/**
     * Read a header value from an iterator over the raw value.
     *
     * There will be no leading white space, but there may be trailing white space.
     * White space comes only in the form SP or HT; the `CR LF SP` form of whitespace is collapsed
     * to just the last character, and the `CR LF` which would indicate the end of the header line
     * in the stream is removed.
     *
     * For types that implement ``FromStr``, a sane-but-potentially-not-as-fast-as-possible default
     * would be::
     *
     *     from_str(reader.collect_to_str())
     *
     * (This is not provided as a default implementation as owing to present upstream limitations
     * that would require the type to implement FromStr also, which is not considered reasonable.)
     */
</span>    <span class='kw'>fn</span> <span class='ident'>from_stream</span><span class='op'>&lt;</span><span class='ident'>R</span>: <span class='ident'>Reader</span><span class='op'>&gt;</span>(<span class='ident'>reader</span>: <span class='kw-2'>&amp;</span><span class='kw-2'>mut</span> <span class='ident'>HeaderValueByteIterator</span><span class='op'>&lt;</span><span class='ident'>R</span><span class='op'>&gt;</span>) <span class='op'>-&gt;</span> <span class='prelude-ty'>Option</span><span class='op'>&lt;</span><span class='ident'>Self</span><span class='op'>&gt;</span>;

    <span class='doccomment'>/**
     * Write the HTTP value of the header to the stream.
     *
     * The default implementation uses the ``http_value`` method; for now, this should tend to be
     * enough, but there may be more efficient ways to do it in certain cases.
     */
</span>    <span class='kw'>fn</span> <span class='ident'>to_stream</span><span class='op'>&lt;</span><span class='ident'>W</span>: <span class='ident'>Writer</span><span class='op'>&gt;</span>(<span class='kw-2'>&amp;</span><span class='self'>self</span>, <span class='ident'>writer</span>: <span class='kw-2'>&amp;</span><span class='kw-2'>mut</span> <span class='ident'>W</span>) <span class='op'>-&gt;</span> <span class='ident'>IoResult</span><span class='op'>&lt;</span>()<span class='op'>&gt;</span> {
        <span class='kw'>let</span> <span class='ident'>s</span> <span class='op'>=</span> <span class='self'>self</span>.<span class='ident'>http_value</span>();
        <span class='ident'>writer</span>.<span class='ident'>write</span>(<span class='ident'>s</span>.<span class='ident'>as_bytes</span>())
    }

    <span class='doccomment'>/**
     * The value of the header as it would be written for an HTTP header.
     *
     * For types which implement ``ToStr``, a body of ``self.to_str()`` will often be sufficient.
     */
</span>    <span class='kw'>fn</span> <span class='ident'>http_value</span>(<span class='kw-2'>&amp;</span><span class='self'>self</span>) <span class='op'>-&gt;</span> <span class='kw-2'>~</span><span class='ident'>str</span>;
}

<span class='doccomment'>/// A header with multiple comma-separated values. Implement this and a HeaderConvertible
</span><span class='doccomment'>/// implementation for Vec&lt;T&gt; is yours for free—just make sure your reading does not consume the
</span><span class='doccomment'>/// comma.
</span><span class='kw'>pub</span> <span class='kw'>trait</span> <span class='ident'>CommaListHeaderConvertible</span>: <span class='ident'>HeaderConvertible</span> {}

<span class='kw'>impl</span><span class='op'>&lt;</span><span class='ident'>T</span>: <span class='ident'>CommaListHeaderConvertible</span><span class='op'>&gt;</span> <span class='ident'>HeaderConvertible</span> <span class='kw'>for</span> <span class='ident'>Vec</span><span class='op'>&lt;</span><span class='ident'>T</span><span class='op'>&gt;</span> {
    <span class='kw'>fn</span> <span class='ident'>from_stream</span><span class='op'>&lt;</span><span class='ident'>R</span>: <span class='ident'>Reader</span><span class='op'>&gt;</span>(<span class='ident'>reader</span>: <span class='kw-2'>&amp;</span><span class='kw-2'>mut</span> <span class='ident'>HeaderValueByteIterator</span><span class='op'>&lt;</span><span class='ident'>R</span><span class='op'>&gt;</span>) <span class='op'>-&gt;</span> <span class='prelude-ty'>Option</span><span class='op'>&lt;</span><span class='ident'>Vec</span><span class='op'>&lt;</span><span class='ident'>T</span><span class='op'>&gt;&gt;</span> {
        <span class='kw'>let</span> <span class='kw-2'>mut</span> <span class='ident'>result</span> <span class='op'>=</span> <span class='ident'>Vec</span>::<span class='ident'>new</span>();
        <span class='kw'>loop</span> {
            <span class='kw'>match</span> <span class='ident'>HeaderConvertible</span>::<span class='ident'>from_stream</span>(<span class='ident'>reader</span>) {
                <span class='prelude-val'>Some</span>(<span class='ident'>h</span>) <span class='op'>=&gt;</span> <span class='ident'>result</span>.<span class='ident'>push</span>(<span class='ident'>h</span>),
                <span class='prelude-val'>None</span> <span class='op'>=&gt;</span> <span class='kw'>return</span> <span class='prelude-val'>None</span>,
            };
            <span class='kw'>match</span> <span class='ident'>reader</span>.<span class='ident'>consume_comma_lws</span>() {
                <span class='ident'>CommaConsumed</span> <span class='op'>=&gt;</span> <span class='kw'>continue</span>,
                <span class='ident'>EndOfValue</span> <span class='op'>=&gt;</span> <span class='kw'>break</span>,
                <span class='ident'>ErrCommaNotFound</span> <span class='op'>=&gt;</span> <span class='kw'>return</span> <span class='prelude-val'>None</span>,
            }
        }
        <span class='prelude-val'>Some</span>(<span class='ident'>result</span>)
    }

    <span class='kw'>fn</span> <span class='ident'>to_stream</span><span class='op'>&lt;</span><span class='ident'>W</span>: <span class='ident'>Writer</span><span class='op'>&gt;</span>(<span class='kw-2'>&amp;</span><span class='self'>self</span>, <span class='ident'>writer</span>: <span class='kw-2'>&amp;</span><span class='kw-2'>mut</span> <span class='ident'>W</span>) <span class='op'>-&gt;</span> <span class='ident'>IoResult</span><span class='op'>&lt;</span>()<span class='op'>&gt;</span> {
        <span class='kw'>for</span> (<span class='ident'>i</span>, <span class='ident'>item</span>) <span class='kw'>in</span> <span class='self'>self</span>.<span class='ident'>iter</span>().<span class='ident'>enumerate</span>() {
            <span class='kw'>if</span> <span class='ident'>i</span> <span class='op'>!=</span> <span class='number'>0</span> {
                <span class='macro'>try</span><span class='macro'>!</span>(<span class='ident'>writer</span>.<span class='ident'>write</span>(<span class='macro'>bytes</span><span class='macro'>!</span>(<span class='string'>&quot;, &quot;</span>)))
            }
            <span class='macro'>try</span><span class='macro'>!</span>(<span class='ident'>item</span>.<span class='ident'>to_stream</span>(<span class='ident'>writer</span>))
        }
        <span class='prelude-val'>Ok</span>(())
    }

    <span class='kw'>fn</span> <span class='ident'>http_value</span>(<span class='kw-2'>&amp;</span><span class='self'>self</span>) <span class='op'>-&gt;</span> <span class='kw-2'>~</span><span class='ident'>str</span> {
        <span class='kw'>let</span> <span class='kw-2'>mut</span> <span class='ident'>out</span> <span class='op'>=</span> <span class='kw-2'>~</span><span class='string'>&quot;&quot;</span>;
        <span class='kw'>for</span> (<span class='ident'>i</span>, <span class='ident'>item</span>) <span class='kw'>in</span> <span class='self'>self</span>.<span class='ident'>iter</span>().<span class='ident'>enumerate</span>() {
            <span class='kw'>if</span> <span class='ident'>i</span> <span class='op'>!=</span> <span class='number'>0</span> {
                <span class='ident'>out</span>.<span class='ident'>push_str</span>(<span class='string'>&quot;, &quot;</span>);
            }
            <span class='ident'>out</span>.<span class='ident'>push_str</span>(<span class='ident'>item</span>.<span class='ident'>http_value</span>())
        }
        <span class='ident'>out</span>
    }
}<span class='comment'>

// Now let&#39;s have some common implementation types.
// Some header types really are arbitrary strings. Let&#39;s cover that case here.
</span><span class='kw'>impl</span> <span class='ident'>HeaderConvertible</span> <span class='kw'>for</span> <span class='kw-2'>~</span><span class='ident'>str</span> {
    <span class='kw'>fn</span> <span class='ident'>from_stream</span><span class='op'>&lt;</span><span class='ident'>R</span>: <span class='ident'>Reader</span><span class='op'>&gt;</span>(<span class='ident'>reader</span>: <span class='kw-2'>&amp;</span><span class='kw-2'>mut</span> <span class='ident'>HeaderValueByteIterator</span><span class='op'>&lt;</span><span class='ident'>R</span><span class='op'>&gt;</span>) <span class='op'>-&gt;</span> <span class='prelude-ty'>Option</span><span class='op'>&lt;</span><span class='kw-2'>~</span><span class='ident'>str</span><span class='op'>&gt;</span> {
        <span class='prelude-val'>Some</span>(<span class='ident'>reader</span>.<span class='ident'>collect_to_str</span>())
    }

    <span class='kw'>fn</span> <span class='ident'>to_stream</span><span class='op'>&lt;</span><span class='ident'>W</span>: <span class='ident'>Writer</span><span class='op'>&gt;</span>(<span class='kw-2'>&amp;</span><span class='self'>self</span>, <span class='ident'>writer</span>: <span class='kw-2'>&amp;</span><span class='kw-2'>mut</span> <span class='ident'>W</span>) <span class='op'>-&gt;</span> <span class='ident'>IoResult</span><span class='op'>&lt;</span>()<span class='op'>&gt;</span> {
        <span class='ident'>writer</span>.<span class='ident'>write</span>(<span class='self'>self</span>.<span class='ident'>as_bytes</span>())
    }

    <span class='kw'>fn</span> <span class='ident'>http_value</span>(<span class='kw-2'>&amp;</span><span class='self'>self</span>) <span class='op'>-&gt;</span> <span class='kw-2'>~</span><span class='ident'>str</span> {
        <span class='self'>self</span>.<span class='ident'>to_owned</span>()
    }
}

<span class='kw'>impl</span> <span class='ident'>HeaderConvertible</span> <span class='kw'>for</span> <span class='ident'>uint</span> {
    <span class='kw'>fn</span> <span class='ident'>from_stream</span><span class='op'>&lt;</span><span class='ident'>R</span>: <span class='ident'>Reader</span><span class='op'>&gt;</span>(<span class='ident'>reader</span>: <span class='kw-2'>&amp;</span><span class='kw-2'>mut</span> <span class='ident'>HeaderValueByteIterator</span><span class='op'>&lt;</span><span class='ident'>R</span><span class='op'>&gt;</span>) <span class='op'>-&gt;</span> <span class='prelude-ty'>Option</span><span class='op'>&lt;</span><span class='ident'>uint</span><span class='op'>&gt;</span> {
        <span class='ident'>from_str</span>(<span class='ident'>reader</span>.<span class='ident'>collect_to_str</span>())
    }

    <span class='kw'>fn</span> <span class='ident'>http_value</span>(<span class='kw-2'>&amp;</span><span class='self'>self</span>) <span class='op'>-&gt;</span> <span class='kw-2'>~</span><span class='ident'>str</span> {
        <span class='self'>self</span>.<span class='ident'>to_str</span>()
    }
}

<span class='kw'>impl</span> <span class='ident'>HeaderConvertible</span> <span class='kw'>for</span> <span class='ident'>Url</span> {
    <span class='kw'>fn</span> <span class='ident'>from_stream</span><span class='op'>&lt;</span><span class='ident'>R</span>: <span class='ident'>Reader</span><span class='op'>&gt;</span>(<span class='ident'>reader</span>: <span class='kw-2'>&amp;</span><span class='kw-2'>mut</span> <span class='ident'>HeaderValueByteIterator</span><span class='op'>&lt;</span><span class='ident'>R</span><span class='op'>&gt;</span>) <span class='op'>-&gt;</span> <span class='prelude-ty'>Option</span><span class='op'>&lt;</span><span class='ident'>Url</span><span class='op'>&gt;</span> {
        <span class='ident'>from_str</span>(<span class='ident'>reader</span>.<span class='ident'>collect_to_str</span>())
    }

    <span class='kw'>fn</span> <span class='ident'>http_value</span>(<span class='kw-2'>&amp;</span><span class='self'>self</span>) <span class='op'>-&gt;</span> <span class='kw-2'>~</span><span class='ident'>str</span> {
        <span class='self'>self</span>.<span class='ident'>to_str</span>()
    }
}

<span class='kw'>impl</span> <span class='ident'>CommaListHeaderConvertible</span> <span class='kw'>for</span> <span class='ident'>Method</span> {}

<span class='kw'>impl</span> <span class='ident'>HeaderConvertible</span> <span class='kw'>for</span> <span class='ident'>Method</span> {
    <span class='kw'>fn</span> <span class='ident'>from_stream</span><span class='op'>&lt;</span><span class='ident'>R</span>: <span class='ident'>Reader</span><span class='op'>&gt;</span>(<span class='ident'>reader</span>: <span class='kw-2'>&amp;</span><span class='kw-2'>mut</span> <span class='ident'>HeaderValueByteIterator</span><span class='op'>&lt;</span><span class='ident'>R</span><span class='op'>&gt;</span>) <span class='op'>-&gt;</span> <span class='prelude-ty'>Option</span><span class='op'>&lt;</span><span class='ident'>Method</span><span class='op'>&gt;</span> {
        <span class='kw'>match</span> <span class='ident'>reader</span>.<span class='ident'>read_token</span>() {
            <span class='prelude-val'>Some</span>(<span class='ident'>s</span>) <span class='op'>=&gt;</span> <span class='ident'>Method</span>::<span class='ident'>from_str_or_new</span>(<span class='ident'>s</span>),
            <span class='prelude-val'>None</span> <span class='op'>=&gt;</span> <span class='prelude-val'>None</span>,
        }
    }

    <span class='kw'>fn</span> <span class='ident'>http_value</span>(<span class='kw-2'>&amp;</span><span class='self'>self</span>) <span class='op'>-&gt;</span> <span class='kw-2'>~</span><span class='ident'>str</span> {
        <span class='self'>self</span>.<span class='ident'>to_str</span>()
    }
}

<span class='doccomment'>/**
 * ``HTTP-date`` is represented as a ``Tm``. (What follows is a quotation from RFC 2616.)
 *
 * HTTP applications have historically allowed three different formats
 * for the representation of date/time stamps:
 *
 *    Sun, 06 Nov 1994 08:49:37 GMT  ; RFC 822, updated by RFC 1123
 *    Sunday, 06-Nov-94 08:49:37 GMT ; RFC 850, obsoleted by RFC 1036
 *    Sun Nov  6 08:49:37 1994       ; ANSI C&#39;s asctime() format
 *
 * The first format is preferred as an Internet standard and represents
 * a fixed-length subset of that defined by RFC 1123 [8] (an update to
 * RFC 822 [9]). The second format is in common use, but is based on the
 * obsolete RFC 850 [12] date format and lacks a four-digit year.
 * HTTP/1.1 clients and servers that parse the date value MUST accept
 * all three formats (for compatibility with HTTP/1.0), though they MUST
 * only generate the RFC 1123 format for representing HTTP-date values
 * in header fields. See section 19.3 for further information.
 *
 *    Note: Recipients of date values are encouraged to be robust in
 *    accepting date values that may have been sent by non-HTTP
 *    applications, as is sometimes the case when retrieving or posting
 *    messages via proxies/gateways to SMTP or NNTP.
 *
 * All HTTP date/time stamps MUST be represented in Greenwich Mean Time
 * (GMT), without exception. For the purposes of HTTP, GMT is exactly
 * equal to UTC (Coordinated Universal Time). This is indicated in the
 * first two formats by the inclusion of &quot;GMT&quot; as the three-letter
 * abbreviation for time zone, and MUST be assumed when reading the
 * asctime format. HTTP-date is case sensitive and MUST NOT include
 * additional LWS beyond that specifically included as SP in the
 * grammar.
 *
 *     HTTP-date    = rfc1123-date | rfc850-date | asctime-date
 *     rfc1123-date = wkday &quot;,&quot; SP date1 SP time SP &quot;GMT&quot;
 *     rfc850-date  = weekday &quot;,&quot; SP date2 SP time SP &quot;GMT&quot;
 *     asctime-date = wkday SP date3 SP time SP 4DIGIT
 *     date1        = 2DIGIT SP month SP 4DIGIT
 *                    ; day month year (e.g., 02 Jun 1982)
 *     date2        = 2DIGIT &quot;-&quot; month &quot;-&quot; 2DIGIT
 *                    ; day-month-year (e.g., 02-Jun-82)
 *     date3        = month SP ( 2DIGIT | ( SP 1DIGIT ))
 *                    ; month day (e.g., Jun  2)
 *     time         = 2DIGIT &quot;:&quot; 2DIGIT &quot;:&quot; 2DIGIT
 *                    ; 00:00:00 - 23:59:59
 *     wkday        = &quot;Mon&quot; | &quot;Tue&quot; | &quot;Wed&quot;
 *                  | &quot;Thu&quot; | &quot;Fri&quot; | &quot;Sat&quot; | &quot;Sun&quot;
 *     weekday      = &quot;Monday&quot; | &quot;Tuesday&quot; | &quot;Wednesday&quot;
 *                  | &quot;Thursday&quot; | &quot;Friday&quot; | &quot;Saturday&quot; | &quot;Sunday&quot;
 *     month        = &quot;Jan&quot; | &quot;Feb&quot; | &quot;Mar&quot; | &quot;Apr&quot;
 *                  | &quot;May&quot; | &quot;Jun&quot; | &quot;Jul&quot; | &quot;Aug&quot;
 *                  | &quot;Sep&quot; | &quot;Oct&quot; | &quot;Nov&quot; | &quot;Dec&quot;
 *
 *    Note: HTTP requirements for the date/time stamp format apply only
 *    to their usage within the protocol stream. Clients and servers are
 *    not required to use these formats for user presentation, request
 *    logging, etc.
 */
</span><span class='kw'>impl</span> <span class='ident'>HeaderConvertible</span> <span class='kw'>for</span> <span class='ident'>Tm</span> {
    <span class='kw'>fn</span> <span class='ident'>from_stream</span><span class='op'>&lt;</span><span class='ident'>R</span>: <span class='ident'>Reader</span><span class='op'>&gt;</span>(<span class='ident'>reader</span>: <span class='kw-2'>&amp;</span><span class='kw-2'>mut</span> <span class='ident'>HeaderValueByteIterator</span><span class='op'>&lt;</span><span class='ident'>R</span><span class='op'>&gt;</span>) <span class='op'>-&gt;</span> <span class='prelude-ty'>Option</span><span class='op'>&lt;</span><span class='ident'>Tm</span><span class='op'>&gt;</span> {
        <span class='kw'>let</span> <span class='ident'>value</span> <span class='op'>=</span> <span class='ident'>reader</span>.<span class='ident'>collect_to_str</span>();<span class='comment'>

        // XXX: %Z actually ignores any timezone other than UTC. Probably not a good idea?
        </span><span class='kw'>match</span> <span class='ident'>strptime</span>(<span class='ident'>value</span>, <span class='string'>&quot;%a, %d %b %Y %T %Z&quot;</span>) {<span class='comment'>  // RFC 822, updated by RFC 1123
            </span><span class='prelude-val'>Ok</span>(<span class='ident'>time</span>) <span class='op'>=&gt;</span> <span class='kw'>return</span> <span class='prelude-val'>Some</span>(<span class='ident'>time</span>),
            <span class='prelude-val'>Err</span>(_) <span class='op'>=&gt;</span> ()
        }

        <span class='kw'>match</span> <span class='ident'>strptime</span>(<span class='ident'>value</span>, <span class='string'>&quot;%A, %d-%b-%y %T %Z&quot;</span>) {<span class='comment'>  // RFC 850, obsoleted by RFC 1036
            </span><span class='prelude-val'>Ok</span>(<span class='ident'>time</span>) <span class='op'>=&gt;</span> <span class='kw'>return</span> <span class='prelude-val'>Some</span>(<span class='ident'>time</span>),
            <span class='prelude-val'>Err</span>(_) <span class='op'>=&gt;</span> ()
        }

        <span class='kw'>match</span> <span class='ident'>strptime</span>(<span class='ident'>value</span>, <span class='string'>&quot;%c&quot;</span>) {<span class='comment'>  // ANSI C&#39;s asctime() format
            </span><span class='prelude-val'>Ok</span>(<span class='ident'>time</span>) <span class='op'>=&gt;</span> <span class='prelude-val'>Some</span>(<span class='ident'>time</span>),
            <span class='prelude-val'>Err</span>(_) <span class='op'>=&gt;</span> <span class='prelude-val'>None</span>
        }
    }

    <span class='kw'>fn</span> <span class='ident'>http_value</span>(<span class='kw-2'>&amp;</span><span class='self'>self</span>) <span class='op'>-&gt;</span> <span class='kw-2'>~</span><span class='ident'>str</span> {
        <span class='self'>self</span>.<span class='ident'>to_utc</span>().<span class='ident'>strftime</span>(<span class='string'>&quot;%a, %d %b %Y %T GMT&quot;</span>)
    }
}

<span class='attribute'>#[<span class='ident'>cfg</span>(<span class='ident'>test</span>)]</span>
<span class='kw'>mod</span> <span class='ident'>test</span> {
    <span class='kw'>use</span> <span class='ident'>time</span>::<span class='ident'>Tm</span>;
    <span class='kw'>use</span> <span class='ident'>headers</span>::<span class='ident'>test_utils</span>::{<span class='ident'>from_stream_with_str</span>, <span class='ident'>to_stream_into_str</span>};
    <span class='kw'>use</span> <span class='ident'>super</span>::<span class='ident'>HeaderConvertible</span>;

    <span class='attribute'>#[<span class='ident'>test</span>]</span>
    <span class='kw'>fn</span> <span class='ident'>test_from_stream_str</span>() {
        <span class='macro'>assert_eq</span><span class='macro'>!</span>(<span class='ident'>from_stream_with_str</span>(<span class='string'>&quot;&quot;</span>), <span class='prelude-val'>Some</span>(<span class='kw-2'>~</span><span class='string'>&quot;&quot;</span>));
        <span class='macro'>assert_eq</span><span class='macro'>!</span>(<span class='ident'>from_stream_with_str</span>(<span class='string'>&quot;foo \&quot;bar baz\&quot;, yay&quot;</span>),
                                  <span class='prelude-val'>Some</span>(<span class='kw-2'>~</span><span class='string'>&quot;foo \&quot;bar baz\&quot;, yay&quot;</span>));
    }

    <span class='attribute'>#[<span class='ident'>test</span>]</span>
    <span class='kw'>fn</span> <span class='ident'>test_http_value_str</span>() {
        <span class='macro'>assert_eq</span><span class='macro'>!</span>((<span class='kw-2'>~</span><span class='string'>&quot;&quot;</span>).<span class='ident'>http_value</span>(), <span class='kw-2'>~</span><span class='string'>&quot;&quot;</span>);
        <span class='macro'>assert_eq</span><span class='macro'>!</span>((<span class='kw-2'>~</span><span class='string'>&quot;foo \&quot;bar baz\&quot;, yay&quot;</span>).<span class='ident'>http_value</span>(), <span class='kw-2'>~</span><span class='string'>&quot;foo \&quot;bar baz\&quot;, yay&quot;</span>);
    }

    <span class='attribute'>#[<span class='ident'>test</span>]</span>
    <span class='kw'>fn</span> <span class='ident'>test_to_stream_str</span>() {
        <span class='kw'>let</span> <span class='ident'>s</span> <span class='op'>=</span> <span class='kw-2'>~</span><span class='string'>&quot;&quot;</span>;
        <span class='macro'>assert_eq</span><span class='macro'>!</span>(<span class='ident'>to_stream_into_str</span>(<span class='kw-2'>&amp;</span><span class='ident'>s</span>), <span class='kw-2'>~</span><span class='string'>&quot;&quot;</span>);
        <span class='kw'>let</span> <span class='ident'>s</span> <span class='op'>=</span> <span class='kw-2'>~</span><span class='string'>&quot;foo \&quot;bar baz\&quot;, yay&quot;</span>;
        <span class='macro'>assert_eq</span><span class='macro'>!</span>(<span class='ident'>to_stream_into_str</span>(<span class='kw-2'>&amp;</span><span class='ident'>s</span>), <span class='kw-2'>~</span><span class='string'>&quot;foo \&quot;bar baz\&quot;, yay&quot;</span>);
    }

    <span class='attribute'>#[<span class='ident'>test</span>]</span>
    <span class='kw'>fn</span> <span class='ident'>test_from_stream_uint</span>() {
        <span class='macro'>assert_eq</span><span class='macro'>!</span>(<span class='ident'>from_stream_with_str</span>::<span class='op'>&lt;</span><span class='ident'>uint</span><span class='op'>&gt;</span>(<span class='string'>&quot;foo bar&quot;</span>), <span class='prelude-val'>None</span>);
        <span class='macro'>assert_eq</span><span class='macro'>!</span>(<span class='ident'>from_stream_with_str</span>::<span class='op'>&lt;</span><span class='ident'>uint</span><span class='op'>&gt;</span>(<span class='string'>&quot;-1&quot;</span>), <span class='prelude-val'>None</span>);
        <span class='macro'>assert_eq</span><span class='macro'>!</span>(<span class='ident'>from_stream_with_str</span>(<span class='string'>&quot;0&quot;</span>), <span class='prelude-val'>Some</span>(<span class='number'>0u</span>));
        <span class='macro'>assert_eq</span><span class='macro'>!</span>(<span class='ident'>from_stream_with_str</span>(<span class='string'>&quot;123456789&quot;</span>), <span class='prelude-val'>Some</span>(<span class='number'>123456789u</span>));
    }

    <span class='attribute'>#[<span class='ident'>test</span>]</span>
    <span class='kw'>fn</span> <span class='ident'>test_http_value_uint</span>() {
        <span class='macro'>assert_eq</span><span class='macro'>!</span>(<span class='number'>0u</span>.<span class='ident'>http_value</span>(), <span class='kw-2'>~</span><span class='string'>&quot;0&quot;</span>);
        <span class='macro'>assert_eq</span><span class='macro'>!</span>(<span class='number'>123456789u</span>.<span class='ident'>http_value</span>(), <span class='kw-2'>~</span><span class='string'>&quot;123456789&quot;</span>);
    }

    <span class='attribute'>#[<span class='ident'>test</span>]</span>
    <span class='kw'>fn</span> <span class='ident'>test_to_stream_uint</span>() {
        <span class='macro'>assert_eq</span><span class='macro'>!</span>(<span class='ident'>to_stream_into_str</span>(<span class='kw-2'>&amp;</span><span class='number'>0u</span>), <span class='kw-2'>~</span><span class='string'>&quot;0&quot;</span>);
        <span class='macro'>assert_eq</span><span class='macro'>!</span>(<span class='ident'>to_stream_into_str</span>(<span class='kw-2'>&amp;</span><span class='number'>123456789u</span>), <span class='kw-2'>~</span><span class='string'>&quot;123456789&quot;</span>);
    }

    <span class='kw'>fn</span> <span class='ident'>sample_tm</span>(<span class='ident'>zone</span>: <span class='kw-2'>~</span><span class='ident'>str</span>) <span class='op'>-&gt;</span> <span class='ident'>Tm</span> {
        <span class='ident'>Tm</span> {
            <span class='ident'>tm_sec</span>: <span class='number'>37</span>,
            <span class='ident'>tm_min</span>: <span class='number'>49</span>,
            <span class='ident'>tm_hour</span>: <span class='number'>8</span>,
            <span class='ident'>tm_mday</span>: <span class='number'>6</span>,
            <span class='ident'>tm_mon</span>: <span class='number'>10</span>,
            <span class='ident'>tm_year</span>: <span class='number'>94</span>,
            <span class='ident'>tm_wday</span>: <span class='number'>0</span>,
            <span class='ident'>tm_yday</span>: <span class='number'>0</span>,
            <span class='ident'>tm_isdst</span>: <span class='number'>0</span>,
            <span class='ident'>tm_gmtoff</span>: <span class='number'>0</span>,
            <span class='ident'>tm_zone</span>: <span class='ident'>zone</span>,
            <span class='ident'>tm_nsec</span>: <span class='number'>0</span>
        }
    }

    <span class='doccomment'>/// Test `from_stream` with an RFC 822 time (updated by RFC 1123)
</span>    <span class='attribute'>#[<span class='ident'>test</span>]</span>
    <span class='kw'>fn</span> <span class='ident'>test_from_stream_rfc822</span>() {
        <span class='macro'>assert_eq</span><span class='macro'>!</span>(<span class='ident'>from_stream_with_str</span>(<span class='string'>&quot;Sun, 06 Nov 1994 08:49:37 GMT&quot;</span>), <span class='prelude-val'>Some</span>(<span class='ident'>sample_tm</span>(<span class='kw-2'>~</span><span class='string'>&quot;UTC&quot;</span>)));
    }

    <span class='doccomment'>/// Test `from_stream` with an RFC 850 time (obsoleted by RFC 1036)
</span>    <span class='attribute'>#[<span class='ident'>test</span>]</span>
    <span class='kw'>fn</span> <span class='ident'>test_from_stream_rfc850</span>() {
        <span class='macro'>assert_eq</span><span class='macro'>!</span>(<span class='ident'>from_stream_with_str</span>(<span class='string'>&quot;Sunday, 06-Nov-94 08:49:37 GMT&quot;</span>), <span class='prelude-val'>Some</span>(<span class='ident'>sample_tm</span>(<span class='kw-2'>~</span><span class='string'>&quot;UTC&quot;</span>)));
    }

    <span class='doccomment'>/// Test `from_stream` with the ANSI C&#39;s asctime() format
</span>    <span class='attribute'>#[<span class='ident'>test</span>]</span>
    <span class='kw'>fn</span> <span class='ident'>test_from_stream_asctime</span>() {
        <span class='macro'>assert_eq</span><span class='macro'>!</span>(<span class='ident'>from_stream_with_str</span>(<span class='string'>&quot;Sun Nov  6 08:49:37 1994&quot;</span>), <span class='prelude-val'>Some</span>(<span class='ident'>sample_tm</span>(<span class='kw-2'>~</span><span class='string'>&quot;&quot;</span>)));
    }

    <span class='doccomment'>/// Test `from_stream` with the ANSI C&#39;s asctime() format on a single digit
</span>    <span class='doccomment'>/// day with only one space (which is invalid).
</span>    <span class='doccomment'>///
</span>    <span class='doccomment'>/// The spec requires *exactly* two spaces for such a day number as this
</span>    <span class='doccomment'>/// and will not accept one, in spite of its dodgy LWS collapsing stance.
</span>    <span class='doccomment'>/// (&quot;All linear white space, including folding, has the same semantics as SP.&quot;)
</span>    <span class='doccomment'>///
</span>    <span class='doccomment'>/// This is a test of dubious value, I&#39;ll admit, but it does make it
</span>    <span class='doccomment'>/// defensible that it&#39;s deliberate, should someone complain. :P
</span>    <span class='attribute'>#[<span class='ident'>test</span>]</span>
    <span class='kw'>fn</span> <span class='ident'>test_from_stream_asctime_remove_lws</span>() {
        <span class='macro'>assert_eq</span><span class='macro'>!</span>(<span class='ident'>from_stream_with_str</span>::<span class='op'>&lt;</span><span class='ident'>Tm</span><span class='op'>&gt;</span>(<span class='string'>&quot;Sun Nov 6 08:49:37 1994&quot;</span>), <span class='prelude-val'>None</span>);
    }

    <span class='doccomment'>/// Test `from_stream` with the ANSI C&#39;s asctime() format on a two-digit day.
</span>    <span class='doccomment'>///
</span>    <span class='doccomment'>/// This is necessary to contrast with `test_from_stream_asctime_remove_lws`,
</span>    <span class='doccomment'>/// because a double-digit day doesn&#39;t have that padding space.
</span>    <span class='attribute'>#[<span class='ident'>test</span>]</span>
    <span class='kw'>fn</span> <span class='ident'>test_from_stream_asctime_double_digit_date</span>() {
        <span class='kw'>let</span> <span class='kw-2'>mut</span> <span class='ident'>tm</span> <span class='op'>=</span> <span class='ident'>sample_tm</span>(<span class='kw-2'>~</span><span class='string'>&quot;&quot;</span>);
        <span class='ident'>tm</span>.<span class='ident'>tm_mday</span> <span class='op'>=</span> <span class='number'>13</span>;
        <span class='macro'>assert_eq</span><span class='macro'>!</span>(<span class='ident'>from_stream_with_str</span>(<span class='string'>&quot;Sun Nov 13 08:49:37 1994&quot;</span>), <span class='prelude-val'>Some</span>(<span class='ident'>tm</span>));
    }

    <span class='doccomment'>/// Test `http_value`, which outputs an RFC 1123 time
</span>    <span class='attribute'>#[<span class='ident'>test</span>]</span>
    <span class='kw'>fn</span> <span class='ident'>test_http_value</span>() {
        <span class='macro'>assert_eq</span><span class='macro'>!</span>(<span class='ident'>sample_tm</span>(<span class='kw-2'>~</span><span class='string'>&quot;UTC&quot;</span>).<span class='ident'>http_value</span>(), <span class='kw-2'>~</span><span class='string'>&quot;Sun, 06 Nov 1994 08:49:37 GMT&quot;</span>);
    }

    <span class='doccomment'>/// Test `to_stream`, which outputs an RFC 1123 time
</span>    <span class='attribute'>#[<span class='ident'>test</span>]</span>
    <span class='kw'>fn</span> <span class='ident'>test_to_stream</span>() {
        <span class='macro'>assert_eq</span><span class='macro'>!</span>(<span class='ident'>to_stream_into_str</span>(<span class='kw-2'>&amp;</span><span class='ident'>sample_tm</span>(<span class='kw-2'>~</span><span class='string'>&quot;UTC&quot;</span>)), <span class='kw-2'>~</span><span class='string'>&quot;Sun, 06 Nov 1994 08:49:37 GMT&quot;</span>);
    }
}

<span class='macro'>macro_rules</span><span class='macro'>!</span> <span class='ident'>headers_mod</span> {
    {
        <span class='attribute'>#[<span class='macro-nonterminal'>$</span><span class='macro-nonterminal'>attr</span>:<span class='ident'>meta</span>]</span><span class='comment'>
        // Not using this because of a &quot;local ambiguity&quot; bug
        //$($attrs:attr)*
        </span><span class='kw'>pub</span> <span class='kw'>mod</span> <span class='macro-nonterminal'>$</span><span class='macro-nonterminal'>mod_name</span>:<span class='ident'>ident</span>;
        <span class='ident'>num_headers</span>: <span class='macro-nonterminal'>$</span><span class='macro-nonterminal'>num_headers</span>:<span class='ident'>pat</span>;
        $(
            <span class='macro-nonterminal'>$</span><span class='macro-nonterminal'>num_id</span>:<span class='ident'>pat</span>,
            <span class='macro-nonterminal'>$</span><span class='macro-nonterminal'>output_name</span>:<span class='ident'>expr</span>,
            <span class='macro-nonterminal'>$</span><span class='macro-nonterminal'>input_name</span>:<span class='ident'>pat</span>,
            <span class='macro-nonterminal'>$</span><span class='macro-nonterminal'>caps_ident</span>:<span class='ident'>ident</span>,
            <span class='macro-nonterminal'>$</span><span class='macro-nonterminal'>lower_ident</span>:<span class='ident'>ident</span>,
            <span class='macro-nonterminal'>$</span><span class='macro-nonterminal'>htype</span>:<span class='ident'>ty</span>;
        )<span class='op'>*</span>
    } <span class='op'>=&gt;</span> {
        <span class='kw'>pub</span> <span class='kw'>mod</span> <span class='macro-nonterminal'>$</span><span class='macro-nonterminal'>mod_name</span> {<span class='comment'>
            //$($attrs;)*
            </span><span class='attribute'>#[<span class='macro-nonterminal'>$</span><span class='macro-nonterminal'>attr</span>]</span>

            <span class='attribute'>#[<span class='ident'>allow</span>(<span class='ident'>unused_imports</span>)]</span>
            <span class='kw'>use</span> <span class='ident'>std</span>::<span class='ident'>io</span>::<span class='ident'>IoResult</span>;
            <span class='kw'>use</span> <span class='ident'>time</span>;
            <span class='kw'>use</span> <span class='ident'>collections</span>::<span class='ident'>treemap</span>::{<span class='ident'>TreeMap</span>, <span class='ident'>Entries</span>};
            <span class='kw'>use</span> <span class='ident'>headers</span>;
            <span class='kw'>use</span> <span class='ident'>headers</span>::{<span class='ident'>HeaderEnum</span>, <span class='ident'>HeaderConvertible</span>, <span class='ident'>HeaderValueByteIterator</span>};

            <span class='kw'>pub</span> <span class='kw'>enum</span> <span class='ident'>Header</span> {
                $(<span class='macro-nonterminal'>$</span><span class='macro-nonterminal'>caps_ident</span>(<span class='macro-nonterminal'>$</span><span class='macro-nonterminal'>htype</span>),)<span class='op'>*</span>
                <span class='ident'>ExtensionHeader</span>(<span class='kw-2'>~</span><span class='ident'>str</span>, <span class='kw-2'>~</span><span class='ident'>str</span>),
            }

            <span class='attribute'>#[<span class='ident'>deriving</span>(<span class='ident'>Clone</span>)]</span>
            <span class='kw'>pub</span> <span class='kw'>struct</span> <span class='ident'>HeaderCollection</span> {
                $(<span class='kw'>pub</span> <span class='macro-nonterminal'>$</span><span class='macro-nonterminal'>lower_ident</span>: <span class='prelude-ty'>Option</span><span class='op'>&lt;</span><span class='macro-nonterminal'>$</span><span class='macro-nonterminal'>htype</span><span class='op'>&gt;</span>,)<span class='op'>*</span>
                <span class='kw'>pub</span> <span class='ident'>extensions</span>: <span class='ident'>TreeMap</span><span class='op'>&lt;</span><span class='kw-2'>~</span><span class='ident'>str</span>, <span class='kw-2'>~</span><span class='ident'>str</span><span class='op'>&gt;</span>,
            }

            <span class='kw'>impl</span> <span class='ident'>HeaderCollection</span> {
                <span class='kw'>pub</span> <span class='kw'>fn</span> <span class='ident'>new</span>() <span class='op'>-&gt;</span> <span class='ident'>HeaderCollection</span> {
                    <span class='ident'>HeaderCollection</span> {
                        $(<span class='macro-nonterminal'>$</span><span class='macro-nonterminal'>lower_ident</span>: <span class='prelude-val'>None</span>,)<span class='op'>*</span>
                        <span class='ident'>extensions</span>: <span class='ident'>TreeMap</span>::<span class='ident'>new</span>(),
                    }
                }

                <span class='kw'>pub</span> <span class='kw'>fn</span> <span class='ident'>get_header</span>(<span class='kw-2'>&amp;</span><span class='kw-2'>mut</span> <span class='self'>self</span>, <span class='ident'>key</span>: <span class='kw-2'>~</span><span class='ident'>str</span>) <span class='op'>-&gt;</span> <span class='prelude-ty'>Option</span><span class='op'>&lt;</span><span class='kw-2'>~</span><span class='ident'>str</span><span class='op'>&gt;</span> {
                    <span class='kw'>for</span> <span class='ident'>header</span> <span class='kw'>in</span> <span class='self'>self</span>.<span class='ident'>iter</span>() {
                        <span class='kw'>if</span> <span class='ident'>header</span>.<span class='ident'>header_name</span>() <span class='op'>==</span> <span class='ident'>key</span> {
                            <span class='kw'>return</span> <span class='prelude-val'>Some</span>(<span class='ident'>header</span>.<span class='ident'>header_value</span>());
                        }
                    }
                    <span class='kw'>return</span> <span class='prelude-val'>None</span>;
                }

                <span class='doccomment'>/// Consume a header, putting it into this structure.
</span>                <span class='kw'>pub</span> <span class='kw'>fn</span> <span class='ident'>insert</span>(<span class='kw-2'>&amp;</span><span class='kw-2'>mut</span> <span class='self'>self</span>, <span class='ident'>header</span>: <span class='ident'>Header</span>) {
                    <span class='kw'>match</span> <span class='ident'>header</span> {
                        $(<span class='macro-nonterminal'>$</span><span class='macro-nonterminal'>caps_ident</span>(<span class='ident'>value</span>) <span class='op'>=&gt;</span> <span class='self'>self</span>.<span class='macro-nonterminal'>$</span><span class='macro-nonterminal'>lower_ident</span> <span class='op'>=</span> <span class='prelude-val'>Some</span>(<span class='ident'>value</span>),)<span class='op'>*</span>
                        <span class='ident'>ExtensionHeader</span>(<span class='ident'>key</span>, <span class='ident'>value</span>) <span class='op'>=&gt;</span> { 
                            <span class='self'>self</span>.<span class='ident'>extensions</span>.<span class='ident'>insert</span>(<span class='ident'>key</span>, <span class='ident'>value</span>); },
                    }
                }

                <span class='kw'>pub</span> <span class='kw'>fn</span> <span class='ident'>iter</span><span class='op'>&lt;</span><span class='lifetime'>&#39;a</span><span class='op'>&gt;</span>(<span class='kw-2'>&amp;</span><span class='lifetime'>&#39;a</span> <span class='self'>self</span>) <span class='op'>-&gt;</span> <span class='ident'>HeaderCollectionIterator</span><span class='op'>&lt;</span><span class='lifetime'>&#39;a</span><span class='op'>&gt;</span> {
                    <span class='ident'>HeaderCollectionIterator</span> {
                        <span class='ident'>pos</span>: <span class='number'>0</span>,
                        <span class='ident'>coll</span>: <span class='self'>self</span>,
                        <span class='ident'>ext_iter</span>: <span class='prelude-val'>None</span>
                    }
                }

                <span class='doccomment'>/// Write all the headers to a writer. This includes an extra \r\n at the end to
</span>                <span class='doccomment'>/// signal end of headers.
</span>                <span class='kw'>pub</span> <span class='kw'>fn</span> <span class='ident'>write_all</span><span class='op'>&lt;</span><span class='ident'>W</span>: <span class='ident'>Writer</span><span class='op'>&gt;</span>(<span class='kw-2'>&amp;</span><span class='self'>self</span>, <span class='ident'>writer</span>: <span class='kw-2'>&amp;</span><span class='kw-2'>mut</span> <span class='ident'>W</span>) <span class='op'>-&gt;</span> <span class='ident'>IoResult</span><span class='op'>&lt;</span>()<span class='op'>&gt;</span> {
                    <span class='kw'>for</span> <span class='ident'>header</span> <span class='kw'>in</span> <span class='self'>self</span>.<span class='ident'>iter</span>() {
                        <span class='macro'>try</span><span class='macro'>!</span>(<span class='ident'>header</span>.<span class='ident'>write_header</span>(<span class='kw-2'>&amp;</span><span class='kw-2'>mut</span> <span class='op'>*</span><span class='ident'>writer</span>));
                    }
                    <span class='ident'>writer</span>.<span class='ident'>write</span>(<span class='macro'>bytes</span><span class='macro'>!</span>(<span class='string'>&quot;\r\n&quot;</span>))
                }
            }

            <span class='kw'>pub</span> <span class='kw'>struct</span> <span class='ident'>HeaderCollectionIterator</span><span class='op'>&lt;</span><span class='lifetime'>&#39;a</span><span class='op'>&gt;</span> {
                <span class='ident'>pos</span>: <span class='ident'>uint</span>,
                <span class='ident'>coll</span>: <span class='kw-2'>&amp;</span><span class='lifetime'>&#39;a</span> <span class='ident'>HeaderCollection</span>,
                <span class='ident'>ext_iter</span>: <span class='prelude-ty'>Option</span><span class='op'>&lt;</span><span class='ident'>Entries</span><span class='op'>&lt;</span><span class='lifetime'>&#39;a</span>, <span class='kw-2'>~</span><span class='ident'>str</span>, <span class='kw-2'>~</span><span class='ident'>str</span><span class='op'>&gt;&gt;</span>
            }

            <span class='kw'>impl</span><span class='op'>&lt;</span><span class='lifetime'>&#39;a</span><span class='op'>&gt;</span> <span class='ident'>Iterator</span><span class='op'>&lt;</span><span class='ident'>Header</span><span class='op'>&gt;</span> <span class='kw'>for</span> <span class='ident'>HeaderCollectionIterator</span><span class='op'>&lt;</span><span class='lifetime'>&#39;a</span><span class='op'>&gt;</span> {
                <span class='kw'>fn</span> <span class='ident'>next</span>(<span class='kw-2'>&amp;</span><span class='kw-2'>mut</span> <span class='self'>self</span>) <span class='op'>-&gt;</span> <span class='prelude-ty'>Option</span><span class='op'>&lt;</span><span class='ident'>Header</span><span class='op'>&gt;</span> {
                    <span class='kw'>loop</span> {
                        <span class='self'>self</span>.<span class='ident'>pos</span> <span class='op'>+=</span> <span class='number'>1</span>;
                        <span class='kw'>match</span> <span class='self'>self</span>.<span class='ident'>pos</span> <span class='op'>-</span> <span class='number'>1</span> {
                            $(<span class='macro-nonterminal'>$</span><span class='macro-nonterminal'>num_id</span> <span class='op'>=&gt;</span> <span class='kw'>match</span> <span class='self'>self</span>.<span class='ident'>coll</span>.<span class='macro-nonterminal'>$</span><span class='macro-nonterminal'>lower_ident</span> {
                                <span class='prelude-val'>Some</span>(<span class='kw-2'>ref</span> <span class='ident'>v</span>) <span class='op'>=&gt;</span> <span class='kw'>return</span> <span class='prelude-val'>Some</span>(<span class='macro-nonterminal'>$</span><span class='macro-nonterminal'>caps_ident</span>(<span class='ident'>v</span>.<span class='ident'>clone</span>())),
                                <span class='prelude-val'>None</span> <span class='op'>=&gt;</span> <span class='kw'>continue</span>,
                            },)<span class='op'>*</span>
                            <span class='macro-nonterminal'>$</span><span class='macro-nonterminal'>num_headers</span> <span class='op'>=&gt;</span> {
                                <span class='self'>self</span>.<span class='ident'>ext_iter</span> <span class='op'>=</span> <span class='prelude-val'>Some</span>(<span class='self'>self</span>.<span class='ident'>coll</span>.<span class='ident'>extensions</span>.<span class='ident'>iter</span>());
                                <span class='kw'>continue</span>
                            },
                            _ <span class='op'>=&gt;</span> <span class='kw'>match</span> <span class='self'>self</span>.<span class='ident'>ext_iter</span>.<span class='ident'>get_mut_ref</span>().<span class='ident'>next</span>() {
                                <span class='prelude-val'>Some</span>((<span class='ident'>k</span>, <span class='ident'>v</span>)) <span class='op'>=&gt;</span>
                                    <span class='kw'>return</span> <span class='prelude-val'>Some</span>(<span class='ident'>ExtensionHeader</span>(<span class='ident'>k</span>.<span class='ident'>to_owned</span>(), <span class='ident'>v</span>.<span class='ident'>to_owned</span>())),
                                <span class='prelude-val'>None</span> <span class='op'>=&gt;</span> <span class='kw'>return</span> <span class='prelude-val'>None</span>,
                            },
                        }
                    }
                }
            }

            <span class='kw'>impl</span> <span class='ident'>HeaderEnum</span> <span class='kw'>for</span> <span class='ident'>Header</span> {
                <span class='kw'>fn</span> <span class='ident'>header_name</span>(<span class='kw-2'>&amp;</span><span class='self'>self</span>) <span class='op'>-&gt;</span> <span class='kw-2'>~</span><span class='ident'>str</span> {
                    <span class='kw'>match</span> <span class='op'>*</span><span class='self'>self</span> {<span class='comment'>
                        // FIXME: $output_name is &quot;...&quot;, I want ~&quot;...&quot; rather than &quot;...&quot;.to_owned()
                        </span>$(<span class='macro-nonterminal'>$</span><span class='macro-nonterminal'>caps_ident</span>(_) <span class='op'>=&gt;</span> <span class='macro-nonterminal'>$</span><span class='macro-nonterminal'>output_name</span>.<span class='ident'>to_owned</span>(),)<span class='op'>*</span>
                        <span class='ident'>ExtensionHeader</span>(<span class='kw-2'>ref</span> <span class='ident'>name</span>, _) <span class='op'>=&gt;</span> <span class='ident'>name</span>.<span class='ident'>to_owned</span>(),
                    }
                }

                <span class='kw'>fn</span> <span class='ident'>header_value</span>(<span class='kw-2'>&amp;</span><span class='self'>self</span>) <span class='op'>-&gt;</span> <span class='kw-2'>~</span><span class='ident'>str</span> {
                    <span class='kw'>match</span> <span class='op'>*</span><span class='self'>self</span> {
                        $(<span class='macro-nonterminal'>$</span><span class='macro-nonterminal'>caps_ident</span>(<span class='kw-2'>ref</span> <span class='ident'>h</span>) <span class='op'>=&gt;</span> <span class='ident'>h</span>.<span class='ident'>http_value</span>(),)<span class='op'>*</span>
                        <span class='ident'>ExtensionHeader</span>(_, <span class='kw-2'>ref</span> <span class='ident'>value</span>) <span class='op'>=&gt;</span> <span class='ident'>value</span>.<span class='ident'>to_owned</span>(),
                    }
                }

                <span class='kw'>fn</span> <span class='ident'>write_header</span><span class='op'>&lt;</span><span class='ident'>W</span>: <span class='ident'>Writer</span><span class='op'>&gt;</span>(<span class='kw-2'>&amp;</span><span class='self'>self</span>, <span class='ident'>writer</span>: <span class='kw-2'>&amp;</span><span class='kw-2'>mut</span> <span class='ident'>W</span>) <span class='op'>-&gt;</span> <span class='ident'>IoResult</span><span class='op'>&lt;</span>()<span class='op'>&gt;</span> {
                    <span class='kw'>match</span> <span class='op'>*</span><span class='self'>self</span> {
                        <span class='ident'>ExtensionHeader</span>(<span class='kw-2'>ref</span> <span class='ident'>name</span>, <span class='kw-2'>ref</span> <span class='ident'>value</span>) <span class='op'>=&gt;</span> {
                            <span class='kw'>return</span> <span class='macro'>write</span><span class='macro'>!</span>(<span class='kw-2'>&amp;</span><span class='kw-2'>mut</span> <span class='op'>*</span><span class='ident'>writer</span> <span class='kw'>as</span> <span class='kw-2'>&amp;</span><span class='kw-2'>mut</span> <span class='ident'>Writer</span>,
                                          <span class='string'>&quot;{}: {}\r\n&quot;</span>, <span class='op'>*</span><span class='ident'>name</span>, <span class='op'>*</span><span class='ident'>value</span>);
                        },
                        _ <span class='op'>=&gt;</span> (),
                    }

                    <span class='macro'>try</span><span class='macro'>!</span>(<span class='macro'>write</span><span class='macro'>!</span>(<span class='kw-2'>&amp;</span><span class='kw-2'>mut</span> <span class='op'>*</span><span class='ident'>writer</span> <span class='kw'>as</span> <span class='kw-2'>&amp;</span><span class='kw-2'>mut</span> <span class='ident'>Writer</span>, <span class='string'>&quot;{}: &quot;</span>, <span class='kw'>match</span> <span class='op'>*</span><span class='self'>self</span> {
                        $(<span class='macro-nonterminal'>$</span><span class='macro-nonterminal'>caps_ident</span>(_) <span class='op'>=&gt;</span> <span class='macro-nonterminal'>$</span><span class='macro-nonterminal'>output_name</span>,)<span class='op'>*</span>
                        <span class='ident'>ExtensionHeader</span>(..) <span class='op'>=&gt;</span> <span class='macro'>unreachable</span><span class='macro'>!</span>(),<span class='comment'>  // Already returned
                    </span>}));<span class='comment'>

                    // FIXME: all the `h` cases satisfy HeaderConvertible, can it be simplified?
                    </span><span class='macro'>try</span><span class='macro'>!</span>(<span class='kw'>match</span> <span class='op'>*</span><span class='self'>self</span> {
                        $(<span class='macro-nonterminal'>$</span><span class='macro-nonterminal'>caps_ident</span>(<span class='kw-2'>ref</span> <span class='ident'>h</span>) <span class='op'>=&gt;</span> <span class='ident'>h</span>.<span class='ident'>to_stream</span>(<span class='ident'>writer</span>),)<span class='op'>*</span>
                        <span class='ident'>ExtensionHeader</span>(..) <span class='op'>=&gt;</span> <span class='macro'>unreachable</span><span class='macro'>!</span>(),<span class='comment'>  // Already returned
                    </span>});
                    <span class='macro'>write</span><span class='macro'>!</span>(<span class='kw-2'>&amp;</span><span class='kw-2'>mut</span> <span class='op'>*</span><span class='ident'>writer</span> <span class='kw'>as</span> <span class='kw-2'>&amp;</span><span class='kw-2'>mut</span> <span class='ident'>Writer</span>, <span class='string'>&quot;\r\n&quot;</span>)
                }

                <span class='kw'>fn</span> <span class='ident'>value_from_stream</span><span class='op'>&lt;</span><span class='ident'>R</span>: <span class='ident'>Reader</span><span class='op'>&gt;</span>(<span class='ident'>name</span>: <span class='kw-2'>~</span><span class='ident'>str</span>, <span class='ident'>value</span>: <span class='kw-2'>&amp;</span><span class='kw-2'>mut</span> <span class='ident'>HeaderValueByteIterator</span><span class='op'>&lt;</span><span class='ident'>R</span><span class='op'>&gt;</span>)
                        <span class='op'>-&gt;</span> <span class='prelude-ty'>Option</span><span class='op'>&lt;</span><span class='ident'>Header</span><span class='op'>&gt;</span> {
                    <span class='kw'>match</span> <span class='ident'>name</span>.<span class='ident'>as_slice</span>() {
                        $(<span class='macro-nonterminal'>$</span><span class='macro-nonterminal'>input_name</span> <span class='op'>=&gt;</span> <span class='kw'>match</span> <span class='ident'>HeaderConvertible</span>::<span class='ident'>from_stream</span>(<span class='ident'>value</span>) {
                            <span class='prelude-val'>Some</span>(<span class='ident'>v</span>) <span class='op'>=&gt;</span> <span class='prelude-val'>Some</span>(<span class='macro-nonterminal'>$</span><span class='macro-nonterminal'>caps_ident</span>(<span class='ident'>v</span>)),
                            <span class='prelude-val'>None</span> <span class='op'>=&gt;</span> <span class='prelude-val'>None</span>,
                        },)<span class='op'>*</span>
                        _ <span class='op'>=&gt;</span> <span class='prelude-val'>Some</span>(<span class='ident'>ExtensionHeader</span>(<span class='ident'>name</span>, <span class='ident'>value</span>.<span class='ident'>collect_to_str</span>())),
                    }
                }
            }
        }
    }
}

<span class='macro'>headers_mod</span><span class='macro'>!</span> {
    <span class='attribute'>#[<span class='ident'>doc</span> <span class='op'>=</span> <span class='string'>&quot;Request whatnottery.&quot;</span>]</span>
    <span class='kw'>pub</span> <span class='kw'>mod</span> <span class='ident'>request</span>;

    <span class='ident'>num_headers</span>: <span class='number'>38</span>;<span class='comment'>

    // RFC 2616, Section 4.5: General Header Fields
     </span><span class='number'>0</span>, <span class='string'>&quot;Cache-Control&quot;</span>,     <span class='string'>&quot;Cache-Control&quot;</span>,     <span class='ident'>CacheControl</span>,     <span class='ident'>cache_control</span>,     <span class='kw-2'>~</span><span class='ident'>str</span>;
     <span class='number'>1</span>, <span class='string'>&quot;Connection&quot;</span>,        <span class='string'>&quot;Connection&quot;</span>,        <span class='ident'>Connection</span>,       <span class='ident'>connection</span>,        <span class='ident'>Vec</span><span class='op'>&lt;</span><span class='ident'>headers</span>::<span class='ident'>connection</span>::<span class='ident'>Connection</span><span class='op'>&gt;</span>;
     <span class='number'>2</span>, <span class='string'>&quot;Date&quot;</span>,              <span class='string'>&quot;Date&quot;</span>,              <span class='ident'>Date</span>,             <span class='ident'>date</span>,              <span class='ident'>time</span>::<span class='ident'>Tm</span>;
     <span class='number'>3</span>, <span class='string'>&quot;Pragma&quot;</span>,            <span class='string'>&quot;Pragma&quot;</span>,            <span class='ident'>Pragma</span>,           <span class='ident'>pragma</span>,            <span class='kw-2'>~</span><span class='ident'>str</span>;
     <span class='number'>4</span>, <span class='string'>&quot;Trailer&quot;</span>,           <span class='string'>&quot;Trailer&quot;</span>,           <span class='ident'>Trailer</span>,          <span class='ident'>trailer</span>,           <span class='kw-2'>~</span><span class='ident'>str</span>;
     <span class='number'>5</span>, <span class='string'>&quot;Transfer-Encoding&quot;</span>, <span class='string'>&quot;Transfer-Encoding&quot;</span>, <span class='ident'>TransferEncoding</span>, <span class='ident'>transfer_encoding</span>, <span class='ident'>Vec</span><span class='op'>&lt;</span><span class='ident'>headers</span>::<span class='ident'>transfer_encoding</span>::<span class='ident'>TransferCoding</span><span class='op'>&gt;</span>;
     <span class='number'>6</span>, <span class='string'>&quot;Upgrade&quot;</span>,           <span class='string'>&quot;Upgrade&quot;</span>,           <span class='ident'>Upgrade</span>,          <span class='ident'>upgrade</span>,           <span class='kw-2'>~</span><span class='ident'>str</span>;
     <span class='number'>7</span>, <span class='string'>&quot;Via&quot;</span>,               <span class='string'>&quot;Via&quot;</span>,               <span class='ident'>Via</span>,              <span class='ident'>via</span>,               <span class='kw-2'>~</span><span class='ident'>str</span>;
     <span class='number'>8</span>, <span class='string'>&quot;Warning&quot;</span>,           <span class='string'>&quot;Warning&quot;</span>,           <span class='ident'>Warning</span>,          <span class='ident'>warning</span>,           <span class='kw-2'>~</span><span class='ident'>str</span>;<span class='comment'>

    // RFC 2616, Section 5.3: Request Header Fields
     </span><span class='number'>9</span>, <span class='string'>&quot;Accept&quot;</span>,              <span class='string'>&quot;Accept&quot;</span>,              <span class='ident'>Accept</span>,             <span class='ident'>accept</span>,              <span class='kw-2'>~</span><span class='ident'>str</span>;
    <span class='number'>10</span>, <span class='string'>&quot;Accept-Charset&quot;</span>,      <span class='string'>&quot;Accept-Charset&quot;</span>,      <span class='ident'>AcceptCharset</span>,      <span class='ident'>accept_charset</span>,      <span class='kw-2'>~</span><span class='ident'>str</span>;
    <span class='number'>11</span>, <span class='string'>&quot;Accept-Encoding&quot;</span>,     <span class='string'>&quot;Accept-Encoding&quot;</span>,     <span class='ident'>AcceptEncoding</span>,     <span class='ident'>accept_encoding</span>,     <span class='kw-2'>~</span><span class='ident'>str</span>;
    <span class='number'>12</span>, <span class='string'>&quot;Accept-Language&quot;</span>,     <span class='string'>&quot;Accept-Language&quot;</span>,     <span class='ident'>AcceptLanguage</span>,     <span class='ident'>accept_language</span>,     <span class='kw-2'>~</span><span class='ident'>str</span>;
    <span class='number'>13</span>, <span class='string'>&quot;Authorization&quot;</span>,       <span class='string'>&quot;Authorization&quot;</span>,       <span class='ident'>Authorization</span>,      <span class='ident'>authorization</span>,       <span class='kw-2'>~</span><span class='ident'>str</span>;
    <span class='number'>14</span>, <span class='string'>&quot;Expect&quot;</span>,              <span class='string'>&quot;Expect&quot;</span>,              <span class='ident'>Expect</span>,             <span class='ident'>expect</span>,              <span class='kw-2'>~</span><span class='ident'>str</span>;
    <span class='number'>15</span>, <span class='string'>&quot;From&quot;</span>,                <span class='string'>&quot;From&quot;</span>,                <span class='ident'>From</span>,               <span class='ident'>from</span>,                <span class='kw-2'>~</span><span class='ident'>str</span>;
    <span class='number'>16</span>, <span class='string'>&quot;Host&quot;</span>,                <span class='string'>&quot;Host&quot;</span>,                <span class='ident'>Host</span>,               <span class='ident'>host</span>,                <span class='ident'>headers</span>::<span class='ident'>host</span>::<span class='ident'>Host</span>;
    <span class='number'>17</span>, <span class='string'>&quot;If-Match&quot;</span>,            <span class='string'>&quot;If-Match&quot;</span>,            <span class='ident'>IfMatch</span>,            <span class='ident'>if_match</span>,            <span class='kw-2'>~</span><span class='ident'>str</span>;
    <span class='number'>18</span>, <span class='string'>&quot;If-Modified-Since&quot;</span>,   <span class='string'>&quot;If-Modified-Since&quot;</span>,   <span class='ident'>IfModifiedSince</span>,    <span class='ident'>if_modified_since</span>,   <span class='ident'>time</span>::<span class='ident'>Tm</span>;
    <span class='number'>19</span>, <span class='string'>&quot;If-None-Match&quot;</span>,       <span class='string'>&quot;If-None-Match&quot;</span>,       <span class='ident'>IfNoneMatch</span>,        <span class='ident'>if_none_match</span>,       <span class='kw-2'>~</span><span class='ident'>str</span>;
    <span class='number'>20</span>, <span class='string'>&quot;If-Range&quot;</span>,            <span class='string'>&quot;If-Range&quot;</span>,            <span class='ident'>IfRange</span>,            <span class='ident'>if_range</span>,            <span class='kw-2'>~</span><span class='ident'>str</span>;
    <span class='number'>21</span>, <span class='string'>&quot;If-Unmodified-Since&quot;</span>, <span class='string'>&quot;If-Unmodified-Since&quot;</span>, <span class='ident'>IfUnmodifiedSince</span>,  <span class='ident'>if_unmodified_since</span>, <span class='ident'>time</span>::<span class='ident'>Tm</span>;
    <span class='number'>22</span>, <span class='string'>&quot;Max-Forwards&quot;</span>,        <span class='string'>&quot;Max-Forwards&quot;</span>,        <span class='ident'>MaxForwards</span>,        <span class='ident'>max_forwards</span>,        <span class='ident'>uint</span>;
    <span class='number'>23</span>, <span class='string'>&quot;Proxy-Authorization&quot;</span>, <span class='string'>&quot;Proxy-Authorization&quot;</span>, <span class='ident'>ProxyAuthorization</span>, <span class='ident'>proxy_authorization</span>, <span class='kw-2'>~</span><span class='ident'>str</span>;
    <span class='number'>24</span>, <span class='string'>&quot;Range&quot;</span>,               <span class='string'>&quot;Range&quot;</span>,               <span class='ident'>Range</span>,              <span class='ident'>range</span>,               <span class='kw-2'>~</span><span class='ident'>str</span>;
    <span class='number'>25</span>, <span class='string'>&quot;Referer&quot;</span>,             <span class='string'>&quot;Referer&quot;</span>,             <span class='ident'>Referer</span>,            <span class='ident'>referer</span>,             <span class='kw-2'>~</span><span class='ident'>str</span>;
    <span class='number'>26</span>, <span class='string'>&quot;TE&quot;</span>,                  <span class='string'>&quot;Te&quot;</span>,                  <span class='ident'>Te</span>,                 <span class='ident'>te</span>,                  <span class='kw-2'>~</span><span class='ident'>str</span>;
    <span class='number'>27</span>, <span class='string'>&quot;User-Agent&quot;</span>,          <span class='string'>&quot;User-Agent&quot;</span>,          <span class='ident'>UserAgent</span>,          <span class='ident'>user_agent</span>,          <span class='kw-2'>~</span><span class='ident'>str</span>;<span class='comment'>

    // RFC 2616, Section 7.1: Entity Header Fields
    </span><span class='number'>28</span>, <span class='string'>&quot;Allow&quot;</span>,            <span class='string'>&quot;Allow&quot;</span>,            <span class='ident'>Allow</span>,           <span class='ident'>allow</span>,            <span class='ident'>Vec</span><span class='op'>&lt;</span>::<span class='ident'>method</span>::<span class='ident'>Method</span><span class='op'>&gt;</span>;
    <span class='number'>29</span>, <span class='string'>&quot;Content-Encoding&quot;</span>, <span class='string'>&quot;Content-Encoding&quot;</span>, <span class='ident'>ContentEncoding</span>, <span class='ident'>content_encoding</span>, <span class='kw-2'>~</span><span class='ident'>str</span>;
    <span class='number'>30</span>, <span class='string'>&quot;Content-Language&quot;</span>, <span class='string'>&quot;Content-Language&quot;</span>, <span class='ident'>ContentLanguage</span>, <span class='ident'>content_language</span>, <span class='kw-2'>~</span><span class='ident'>str</span>;
    <span class='number'>31</span>, <span class='string'>&quot;Content-Length&quot;</span>,   <span class='string'>&quot;Content-Length&quot;</span>,   <span class='ident'>ContentLength</span>,   <span class='ident'>content_length</span>,   <span class='ident'>uint</span>;
    <span class='number'>32</span>, <span class='string'>&quot;Content-Location&quot;</span>, <span class='string'>&quot;Content-Location&quot;</span>, <span class='ident'>ContentLocation</span>, <span class='ident'>content_location</span>, <span class='kw-2'>~</span><span class='ident'>str</span>;
    <span class='number'>33</span>, <span class='string'>&quot;Content-MD5&quot;</span>,      <span class='string'>&quot;Content-Md5&quot;</span>,      <span class='ident'>ContentMd5</span>,      <span class='ident'>content_md5</span>,      <span class='kw-2'>~</span><span class='ident'>str</span>;
    <span class='number'>34</span>, <span class='string'>&quot;Content-Range&quot;</span>,    <span class='string'>&quot;Content-Range&quot;</span>,    <span class='ident'>ContentRange</span>,    <span class='ident'>content_range</span>,    <span class='kw-2'>~</span><span class='ident'>str</span>;
    <span class='number'>35</span>, <span class='string'>&quot;Content-Type&quot;</span>,     <span class='string'>&quot;Content-Type&quot;</span>,     <span class='ident'>ContentType</span>,     <span class='ident'>content_type</span>,     <span class='ident'>headers</span>::<span class='ident'>content_type</span>::<span class='ident'>MediaType</span>;
    <span class='number'>36</span>, <span class='string'>&quot;Expires&quot;</span>,          <span class='string'>&quot;Expires&quot;</span>,          <span class='ident'>Expires</span>,         <span class='ident'>expires</span>,          <span class='ident'>time</span>::<span class='ident'>Tm</span>;
    <span class='number'>37</span>, <span class='string'>&quot;Last-Modified&quot;</span>,    <span class='string'>&quot;Last-Modified&quot;</span>,    <span class='ident'>LastModified</span>,    <span class='ident'>last_modified</span>,    <span class='ident'>time</span>::<span class='ident'>Tm</span>;
}

<span class='macro'>headers_mod</span><span class='macro'>!</span> {
    <span class='attribute'>#[<span class='ident'>doc</span> <span class='op'>=</span> <span class='string'>&quot;Response whatnottery.&quot;</span>]</span>
    <span class='kw'>pub</span> <span class='kw'>mod</span> <span class='ident'>response</span>;

    <span class='ident'>num_headers</span>: <span class='number'>29</span>;<span class='comment'>

    // RFC 2616, Section 4.5: General Header Fields
     </span><span class='number'>0</span>, <span class='string'>&quot;Cache-Control&quot;</span>,     <span class='string'>&quot;Cache-Control&quot;</span>,     <span class='ident'>CacheControl</span>,     <span class='ident'>cache_control</span>,     <span class='kw-2'>~</span><span class='ident'>str</span>;
     <span class='number'>1</span>, <span class='string'>&quot;Connection&quot;</span>,        <span class='string'>&quot;Connection&quot;</span>,        <span class='ident'>Connection</span>,       <span class='ident'>connection</span>,        <span class='ident'>Vec</span><span class='op'>&lt;</span><span class='ident'>headers</span>::<span class='ident'>connection</span>::<span class='ident'>Connection</span><span class='op'>&gt;</span>;
     <span class='number'>2</span>, <span class='string'>&quot;Date&quot;</span>,              <span class='string'>&quot;Date&quot;</span>,              <span class='ident'>Date</span>,             <span class='ident'>date</span>,              <span class='ident'>time</span>::<span class='ident'>Tm</span>;
     <span class='number'>3</span>, <span class='string'>&quot;Pragma&quot;</span>,            <span class='string'>&quot;Pragma&quot;</span>,            <span class='ident'>Pragma</span>,           <span class='ident'>pragma</span>,            <span class='kw-2'>~</span><span class='ident'>str</span>;
     <span class='number'>4</span>, <span class='string'>&quot;Trailer&quot;</span>,           <span class='string'>&quot;Trailer&quot;</span>,           <span class='ident'>Trailer</span>,          <span class='ident'>trailer</span>,           <span class='kw-2'>~</span><span class='ident'>str</span>;
     <span class='number'>5</span>, <span class='string'>&quot;Transfer-Encoding&quot;</span>, <span class='string'>&quot;Transfer-Encoding&quot;</span>, <span class='ident'>TransferEncoding</span>, <span class='ident'>transfer_encoding</span>, <span class='ident'>Vec</span><span class='op'>&lt;</span><span class='ident'>headers</span>::<span class='ident'>transfer_encoding</span>::<span class='ident'>TransferCoding</span><span class='op'>&gt;</span>;
     <span class='number'>6</span>, <span class='string'>&quot;Upgrade&quot;</span>,           <span class='string'>&quot;Upgrade&quot;</span>,           <span class='ident'>Upgrade</span>,          <span class='ident'>upgrade</span>,           <span class='kw-2'>~</span><span class='ident'>str</span>;
     <span class='number'>7</span>, <span class='string'>&quot;Via&quot;</span>,               <span class='string'>&quot;Via&quot;</span>,               <span class='ident'>Via</span>,              <span class='ident'>via</span>,               <span class='kw-2'>~</span><span class='ident'>str</span>;
     <span class='number'>8</span>, <span class='string'>&quot;Warning&quot;</span>,           <span class='string'>&quot;Warning&quot;</span>,           <span class='ident'>Warning</span>,          <span class='ident'>warning</span>,           <span class='kw-2'>~</span><span class='ident'>str</span>;<span class='comment'>

    // RFC 2616, Section 6.2: Response Header Fields
     </span><span class='number'>9</span>, <span class='string'>&quot;Accept-Patch&quot;</span>,       <span class='string'>&quot;Accept-Patch&quot;</span>,       <span class='ident'>AcceptPatch</span>,       <span class='ident'>accept_patch</span>,       <span class='kw-2'>~</span><span class='ident'>str</span>;
    <span class='number'>10</span>, <span class='string'>&quot;Accept-Ranges&quot;</span>,      <span class='string'>&quot;Accept-Ranges&quot;</span>,      <span class='ident'>AcceptRanges</span>,      <span class='ident'>accept_ranges</span>,      <span class='ident'>headers</span>::<span class='ident'>accept_ranges</span>::<span class='ident'>AcceptableRanges</span>;
    <span class='number'>11</span>, <span class='string'>&quot;Age&quot;</span>,                <span class='string'>&quot;Age&quot;</span>,                <span class='ident'>Age</span>,               <span class='ident'>age</span>,                <span class='kw-2'>~</span><span class='ident'>str</span>;
    <span class='number'>12</span>, <span class='string'>&quot;ETag&quot;</span>,               <span class='string'>&quot;Etag&quot;</span>,               <span class='ident'>ETag</span>,              <span class='ident'>etag</span>,               <span class='ident'>headers</span>::<span class='ident'>etag</span>::<span class='ident'>EntityTag</span>;
    <span class='number'>13</span>, <span class='string'>&quot;Location&quot;</span>,           <span class='string'>&quot;Location&quot;</span>,           <span class='ident'>Location</span>,          <span class='ident'>location</span>,           ::<span class='ident'>url</span>::<span class='ident'>Url</span>;
    <span class='number'>14</span>, <span class='string'>&quot;Proxy-Authenticate&quot;</span>, <span class='string'>&quot;Proxy-Authenticate&quot;</span>, <span class='ident'>ProxyAuthenticate</span>, <span class='ident'>proxy_authenticate</span>, <span class='kw-2'>~</span><span class='ident'>str</span>;
    <span class='number'>15</span>, <span class='string'>&quot;Retry-After&quot;</span>,        <span class='string'>&quot;Retry-After&quot;</span>,        <span class='ident'>RetryAfter</span>,        <span class='ident'>retry_after</span>,        <span class='kw-2'>~</span><span class='ident'>str</span>;
    <span class='number'>16</span>, <span class='string'>&quot;Server&quot;</span>,             <span class='string'>&quot;Server&quot;</span>,             <span class='ident'>Server</span>,            <span class='ident'>server</span>,             <span class='kw-2'>~</span><span class='ident'>str</span>;
    <span class='number'>17</span>, <span class='string'>&quot;Vary&quot;</span>,               <span class='string'>&quot;Vary&quot;</span>,               <span class='ident'>Vary</span>,              <span class='ident'>vary</span>,               <span class='kw-2'>~</span><span class='ident'>str</span>;
    <span class='number'>18</span>, <span class='string'>&quot;WWW-Authenticate&quot;</span>,   <span class='string'>&quot;Www-Authenticate&quot;</span>,   <span class='ident'>WwwAuthenticate</span>,   <span class='ident'>www_authenticate</span>,   <span class='kw-2'>~</span><span class='ident'>str</span>;<span class='comment'>

    // RFC 2616, Section 7.1: Entity Header Fields
    </span><span class='number'>19</span>, <span class='string'>&quot;Allow&quot;</span>,            <span class='string'>&quot;Allow&quot;</span>,            <span class='ident'>Allow</span>,           <span class='ident'>allow</span>,            <span class='ident'>Vec</span><span class='op'>&lt;</span>::<span class='ident'>method</span>::<span class='ident'>Method</span><span class='op'>&gt;</span>;
    <span class='number'>20</span>, <span class='string'>&quot;Content-Encoding&quot;</span>, <span class='string'>&quot;Content-Encoding&quot;</span>, <span class='ident'>ContentEncoding</span>, <span class='ident'>content_encoding</span>, <span class='kw-2'>~</span><span class='ident'>str</span>;
    <span class='number'>21</span>, <span class='string'>&quot;Content-Language&quot;</span>, <span class='string'>&quot;Content-Language&quot;</span>, <span class='ident'>ContentLanguage</span>, <span class='ident'>content_language</span>, <span class='kw-2'>~</span><span class='ident'>str</span>;
    <span class='number'>22</span>, <span class='string'>&quot;Content-Length&quot;</span>,   <span class='string'>&quot;Content-Length&quot;</span>,   <span class='ident'>ContentLength</span>,   <span class='ident'>content_length</span>,   <span class='ident'>uint</span>;
    <span class='number'>23</span>, <span class='string'>&quot;Content-Location&quot;</span>, <span class='string'>&quot;Content-Location&quot;</span>, <span class='ident'>ContentLocation</span>, <span class='ident'>content_location</span>, <span class='kw-2'>~</span><span class='ident'>str</span>;
    <span class='number'>24</span>, <span class='string'>&quot;Content-MD5&quot;</span>,      <span class='string'>&quot;Content-Md5&quot;</span>,      <span class='ident'>ContentMd5</span>,      <span class='ident'>content_md5</span>,      <span class='kw-2'>~</span><span class='ident'>str</span>;
    <span class='number'>25</span>, <span class='string'>&quot;Content-Range&quot;</span>,    <span class='string'>&quot;Content-Range&quot;</span>,    <span class='ident'>ContentRange</span>,    <span class='ident'>content_range</span>,    <span class='kw-2'>~</span><span class='ident'>str</span>;
    <span class='number'>26</span>, <span class='string'>&quot;Content-Type&quot;</span>,     <span class='string'>&quot;Content-Type&quot;</span>,     <span class='ident'>ContentType</span>,     <span class='ident'>content_type</span>,     <span class='ident'>headers</span>::<span class='ident'>content_type</span>::<span class='ident'>MediaType</span>;
    <span class='number'>27</span>, <span class='string'>&quot;Expires&quot;</span>,          <span class='string'>&quot;Expires&quot;</span>,          <span class='ident'>Expires</span>,         <span class='ident'>expires</span>,          <span class='kw-2'>~</span><span class='ident'>str</span>;<span class='comment'> // TODO: Should be Tm
    </span><span class='number'>28</span>, <span class='string'>&quot;Last-Modified&quot;</span>,    <span class='string'>&quot;Last-Modified&quot;</span>,    <span class='ident'>LastModified</span>,    <span class='ident'>last_modified</span>,    <span class='ident'>time</span>::<span class='ident'>Tm</span>;
}
</pre>
</section>
    <section id='search' class="content hidden"></section>

    <section class="footer"></section>

    <div id="help" class="hidden">
        <div class="shortcuts">
            <h1>Keyboard shortcuts</h1>
            <dl>
                <dt>?</dt>
                <dd>Show this help dialog</dd>
                <dt>S</dt>
                <dd>Focus the search field</dd>
                <dt>&uarr;</dt>
                <dd>Move up in search results</dd>
                <dt>&darr;</dt>
                <dd>Move down in search results</dd>
                <dt>&#9166;</dt>
                <dd>Go to active search result</dd>
            </dl>
        </div>
        <div class="infos">
            <h1>Search tricks</h1>
            <p>
                Prefix searches with a type followed by a colon (e.g.
                <code>fn:</code>) to restrict the search to a given type.
            </p>
            <p>
                Accepted types are: <code>fn</code>, <code>mod</code>,
                <code>struct</code> (or <code>str</code>), <code>enum</code>,
                <code>trait</code>, <code>typedef</code> (or
                <code>tdef</code>).
            </p>
        </div>
    </div>

    <script>
        var rootPath = "../../../../../../";
        var currentCrate = "http";
    </script>
    <script src="../../../../../../jquery.js"></script>
    <script src="../../../../../../main.js"></script>
    <script async src="../../../../../../search-index.js"></script>
</body>
</html>
